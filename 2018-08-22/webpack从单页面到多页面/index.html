<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>webpack从单页面到多页面 | 磨蹭先生</title><meta name="description" content="从上次更完webpack从什么都不懂到入门之后，好久没有更新过文章了，可能是因为自己懒了吧。今天看了下自己的索引量少了一半o(╥﹏╥)o，发现事态严重，赶紧更新一篇23333"><meta name="keywords" content="webpack"><meta name="author" content="gating"><meta name="copyright" content="gating"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/GATING/blog_imgs@master/blog/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://hm.baidu.com"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="webpack从单页面到多页面"><meta name="twitter:description" content="从上次更完webpack从什么都不懂到入门之后，好久没有更新过文章了，可能是因为自己懒了吧。今天看了下自己的索引量少了一半o(╥﹏╥)o，发现事态严重，赶紧更新一篇23333"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta property="og:type" content="article"><meta property="og:title" content="webpack从单页面到多页面"><meta property="og:url" content="https://gatings.cn/2018-08-22/webpack%E4%BB%8E%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%88%B0%E5%A4%9A%E9%A1%B5%E9%9D%A2/"><meta property="og:site_name" content="磨蹭先生"><meta property="og:description" content="从上次更完webpack从什么都不懂到入门之后，好久没有更新过文章了，可能是因为自己懒了吧。今天看了下自己的索引量少了一半o(╥﹏╥)o，发现事态严重，赶紧更新一篇23333"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = '1'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://gatings.cn/2018-08-22/webpack%E4%BB%8E%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%88%B0%E5%A4%9A%E9%A1%B5%E9%9D%A2/"><link rel="prev" title="awardRotate转盘插件文字模糊问题和图片加载问题" href="https://gatings.cn/2018-10-24/awardRotate%E8%BD%AC%E7%9B%98%E6%8F%92%E4%BB%B6%E6%96%87%E5%AD%97%E6%A8%A1%E7%B3%8A%E9%97%AE%E9%A2%98%E5%92%8C%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD%E9%97%AE%E9%A2%98/"><link rel="next" title="webpack从什么都不懂到入门" href="https://gatings.cn/2018-06-15/webpack%E4%BB%8E%E4%BB%80%E4%B9%88%E9%83%BD%E4%B8%8D%E6%87%82%E5%88%B0%E5%85%A5%E9%97%A8/"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?914d8fcbdf614fcc92017b47706d7bee";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://gatings.cn/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: true,
  Snackbar: {"bookmark":{"title":"Snackbar.bookmark.title","message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: true,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="磨蹭先生" type="application/atom+xml">
</head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">磨蹭先生</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">28</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">12</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">5</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#前言"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">前言</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#模块化"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">模块化</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#什么是模块化"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">什么是模块化</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#CommonJS"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text">CommonJS</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#AMD"><span class="toc_mobile_items-number">2.3.</span> <span class="toc_mobile_items-text">AMD</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#CMD"><span class="toc_mobile_items-number">2.4.</span> <span class="toc_mobile_items-text">CMD</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#UMD"><span class="toc_mobile_items-number">2.5.</span> <span class="toc_mobile_items-text">UMD</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#实现webpack模块化"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">实现webpack模块化</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#entry"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text">entry</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#output"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text">output</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#module"><span class="toc_mobile_items-number">3.3.</span> <span class="toc_mobile_items-text">module</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#plugins"><span class="toc_mobile_items-number">3.4.</span> <span class="toc_mobile_items-text">plugins</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#devServer"><span class="toc_mobile_items-number">3.5.</span> <span class="toc_mobile_items-text">devServer</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#optimization"><span class="toc_mobile_items-number">3.6.</span> <span class="toc_mobile_items-text">optimization</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#webpack-config-js"><span class="toc_mobile_items-number">3.7.</span> <span class="toc_mobile_items-text">webpack.config.js</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#多页面构建（正题）"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">多页面构建（正题）</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#模板引擎篇"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">模板引擎篇</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#layout模板篇"><span class="toc_mobile_items-number">5.1.</span> <span class="toc_mobile_items-text">layout模板篇</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#pages页面篇"><span class="toc_mobile_items-number">5.2.</span> <span class="toc_mobile_items-text">pages页面篇</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#掉坑篇"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text">掉坑篇</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#css-loader的坑"><span class="toc_mobile_items-number">6.1.</span> <span class="toc_mobile_items-text">css-loader的坑</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#字体文件的坑"><span class="toc_mobile_items-number">6.2.</span> <span class="toc_mobile_items-text">字体文件的坑</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#优化篇"><span class="toc_mobile_items-number">7.</span> <span class="toc_mobile_items-text">优化篇</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#babel优化"><span class="toc_mobile_items-number">7.1.</span> <span class="toc_mobile_items-text">babel优化</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#DllPlugin"><span class="toc_mobile_items-number">7.2.</span> <span class="toc_mobile_items-text">DllPlugin</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#webpack-dll-config-js存在的问题"><span class="toc_mobile_items-number">7.2.1.</span> <span class="toc_mobile_items-text">webpack-dll.config.js存在的问题</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#总结"><span class="toc_mobile_items-number">8.</span> <span class="toc_mobile_items-text">总结</span></a></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#模块化"><span class="toc-number">2.</span> <span class="toc-text">模块化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是模块化"><span class="toc-number">2.1.</span> <span class="toc-text">什么是模块化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CommonJS"><span class="toc-number">2.2.</span> <span class="toc-text">CommonJS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AMD"><span class="toc-number">2.3.</span> <span class="toc-text">AMD</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CMD"><span class="toc-number">2.4.</span> <span class="toc-text">CMD</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UMD"><span class="toc-number">2.5.</span> <span class="toc-text">UMD</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#实现webpack模块化"><span class="toc-number">3.</span> <span class="toc-text">实现webpack模块化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#entry"><span class="toc-number">3.1.</span> <span class="toc-text">entry</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#output"><span class="toc-number">3.2.</span> <span class="toc-text">output</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#module"><span class="toc-number">3.3.</span> <span class="toc-text">module</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#plugins"><span class="toc-number">3.4.</span> <span class="toc-text">plugins</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#devServer"><span class="toc-number">3.5.</span> <span class="toc-text">devServer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#optimization"><span class="toc-number">3.6.</span> <span class="toc-text">optimization</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#webpack-config-js"><span class="toc-number">3.7.</span> <span class="toc-text">webpack.config.js</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#多页面构建（正题）"><span class="toc-number">4.</span> <span class="toc-text">多页面构建（正题）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#模板引擎篇"><span class="toc-number">5.</span> <span class="toc-text">模板引擎篇</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#layout模板篇"><span class="toc-number">5.1.</span> <span class="toc-text">layout模板篇</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pages页面篇"><span class="toc-number">5.2.</span> <span class="toc-text">pages页面篇</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#掉坑篇"><span class="toc-number">6.</span> <span class="toc-text">掉坑篇</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#css-loader的坑"><span class="toc-number">6.1.</span> <span class="toc-text">css-loader的坑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#字体文件的坑"><span class="toc-number">6.2.</span> <span class="toc-text">字体文件的坑</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#优化篇"><span class="toc-number">7.</span> <span class="toc-text">优化篇</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#babel优化"><span class="toc-number">7.1.</span> <span class="toc-text">babel优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DllPlugin"><span class="toc-number">7.2.</span> <span class="toc-text">DllPlugin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack-dll-config-js存在的问题"><span class="toc-number">7.2.1.</span> <span class="toc-text">webpack-dll.config.js存在的问题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#总结"><span class="toc-number">8.</span> <span class="toc-text">总结</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png)"><div id="post-info"><div id="post-title"><div class="posttitle">webpack从单页面到多页面</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2018-08-22<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-03-04</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E8%AE%B0%E5%BD%95/">记录</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon fa-fw" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">5k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon fa-fw" aria-hidden="true"></i><span>阅读时长: 19 分钟</span><div class="post-meta-pv-cv"><span class="post-meta__separator">|</span><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>从上次更完webpack从什么都不懂到入门之后，好久没有更新过文章了，可能是因为自己懒了吧。今天看了下自己的索引量少了一半o(╥﹏╥)o，发现事态严重，赶紧更新一篇23333</p>
<p>也是因为最近踩了一些多页面的坑，搭了一个简单的多页面架构，对于单页面我想大家看了上篇文章基本入门了吧，接下来我们就开始玩玩多页面了。</p>
<p>那么闲话就不多说了，开始进入正题吧</p>
<blockquote>
<p>本文的webpack基于webpack4.0，具体是4.12.0版本</p>
</blockquote>
<h1 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h1><p>对于我们上一个项目，我们没有把我们的webpack的模块化，而对于我们之前写的单页面也越来越大，管理起来也颇为麻烦，而自从es6出来以后，模块化也逐渐融入了前端的思想当中。</p>
<p>接下来，我们简单了解一下前端的模块化规范和如何实现我们的webpack模块化吧</p>
<h2 id="什么是模块化"><a href="#什么是模块化" class="headerlink" title="什么是模块化"></a>什么是模块化</h2><p>在了解前端模块化规范前，还是需要先来简单地了解下什么是模块化，模块化开发？</p>
<blockquote>
<p>模块化是指解决一个复杂问题时自顶向下逐层把系统划分成若干模块的过程，有多种属性，分别反映其内部特性。</p>
</blockquote>
<p>接力借助大佬的一句话，</p>
<blockquote>
<p>很多人觉得模块化开发的工程意义是复用，我不太认可这种看法，在我看来，模块化开发的最大价值应该是分治，是分治，分治！（重说三）。不管你将来是否要复用某段代码，你都有充分的理由将其分治为一个模块。</p>
</blockquote>
<p>首先，既然是模块化设计，那么作为一个模块化系统所必须的能力：</p>
<ul>
<li>定义封装的模块。</li>
<li>定义新模块对其他模块的依赖。</li>
<li>可对其他模块的引入支持。</li>
</ul>
<p>好了，思想有了，那么总要有点什么来建立一个模块化的规范制度吧，不然各式各样的模块加载方式只会将局搅得更为混乱。那么我们接下来就讲讲JavaScript的模块化规范。</p>
<h2 id="CommonJS"><a href="#CommonJS" class="headerlink" title="CommonJS"></a>CommonJS</h2><p>在es6没出来之前，js是没有模块的功能，所以CommonJS应运而生 </p>
<p>CommonJS定义的模块分为:</p>
<ul>
<li>模块引用(require)</li>
<li>模块定义(exports)</li>
<li>模块标识(module)</li>
</ul>
<p>require()用来引入外部模块；exports对象用于导出当前模块的方法或变量，唯一的导出口；module对象就代表模块本身。</p>
<h2 id="AMD"><a href="#AMD" class="headerlink" title="AMD"></a>AMD</h2><p>由于一个重大的局限，使得CommonJS规范不适用于浏览器环境。因为我们请求的模块都放在服务器端，等待时间取决于网速的快慢，可能要等很长时间，浏览器处于”假死”状态。</p>
<p>因此，浏览器端的模块，不能采用”同步加载”（synchronous），只能采用”异步加载”（asynchronous）。这就是AMD规范诞生的背景。</p>
<p>于是乎，AMD(异步模块定义)出现了，它就主要为前端JS的表现制定规范。而AMD就只有一个接口：define(id?,dependencies?,factory);</p>
<p>AMD 是 RequireJS 在推广过程中对模块定义的规范化产出</p>
<h2 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h2><p><a href="https://github.com/seajs/seajs/issues/242" target="_blank" rel="noopener">CMD传送门</a></p>
<p>CMD 与 AMD 挺相近，二者区别如下：</p>
<ol>
<li><p>对于依赖的模块AMD是提前执行，CMD是延迟执行。(RequireJS 从 2.0 开始，也改成可以延迟执行)</p>
</li>
<li><p>CMD推崇依赖就近，按需加载；AMD推崇依赖前置。</p>
</li>
<li><p>AMD 的 api 默认是一个当多个用，CMD 严格的区分推崇职责单一，其每个 API 都简单纯粹。</p>
</li>
</ol>
<p>CMD 是 SeaJS 在推广过程中对模块定义的规范化产出</p>
<h2 id="UMD"><a href="#UMD" class="headerlink" title="UMD"></a>UMD</h2><p>UMD是AMD与CommonJS模块方式的糅合。</p>
<p>AMD 浏览器第一的原则发展 异步加载模块。</p>
<p>CommonJS 模块以服务器第一原则发展，选择同步加载，它的模块无需包装(unwrapped modules)。</p>
<p>这迫使人们又想出另一个更通用的模式UMD （Universal Module Definition）。希望解决跨平台的解决方案。</p>
<p>他的缺点是：代码量太大。兼容需要额外的代码，而且是每个文件都要写这么一大段代码。</p>
<h1 id="实现webpack模块化"><a href="#实现webpack模块化" class="headerlink" title="实现webpack模块化"></a>实现webpack模块化</h1><p>当然，webpack模块化是基于CommonJs的，接下来我们一步一步的修改我们之前那个单页面的webpack-demo，先试着把webpakc-demo的模块化。</p>
<p>在根目录下新建 config 的文件夹，用于存放我们各个模块的配置文件</p>
<h2 id="entry"><a href="#entry" class="headerlink" title="entry"></a>entry</h2><p>在config目录下新建 entry.js 文件</p>
<p>代码如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    index: <span class="string">'./src/js/index.js'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="output"><a href="#output" class="headerlink" title="output"></a>output</h2><p>在config目录下新建 output.js 文件</p>
<p>代码如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 必须是绝对路劲</span></span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'../dist'</span>),</span><br><span class="line">    filename: <span class="string">'js/[name].js'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="module"><a href="#module" class="headerlink" title="module"></a>module</h2><p>在config目录下新建 modules.js 文件</p>
<p>代码如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        use: [<span class="string">'babel-loader'</span>],</span><br><span class="line">        <span class="comment">// 除node_modules目录外，其他都babel编译</span></span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// 从右向左(从下向上)开始执行</span></span><br><span class="line">        <span class="comment">// 提取css</span></span><br><span class="line">        use: ExtractTextPlugin.extract(&#123;</span><br><span class="line">            <span class="comment">// 只在开发环境使用</span></span><br><span class="line">            <span class="comment">// use style-loader in development</span></span><br><span class="line">            fallback: <span class="string">'style-loader'</span>,</span><br><span class="line">            use: [&#123;</span><br><span class="line">                loader: <span class="string">'css-loader'</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    minimize: <span class="literal">true</span> <span class="comment">//css压缩</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                loader: <span class="string">'postcss-loader'</span></span><br><span class="line">            &#125;],</span><br><span class="line">            <span class="comment">// 解决css打包背景图的路径问题</span></span><br><span class="line">            publicPath: <span class="string">'../'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="comment">// use:['style-loader','css-loader','less-loader']</span></span><br><span class="line">        <span class="comment">// 如果想分离less</span></span><br><span class="line">        use: ExtractTextPlugin.extract(&#123;</span><br><span class="line">            <span class="comment">// 只在开发环境使用</span></span><br><span class="line">            <span class="comment">// use style-loader in development</span></span><br><span class="line">            fallback: <span class="string">'style-loader'</span>,</span><br><span class="line">            use: [<span class="string">'css-loader'</span>, <span class="string">'postcss-loader'</span>, <span class="string">'less-loader'</span>],</span><br><span class="line">            <span class="comment">// 解决css打包背景图的路径问题</span></span><br><span class="line">            publicPath: <span class="string">'../'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|jpg|gif)$/</span>,</span><br><span class="line">        use: [&#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">                <span class="comment">// 小于10kb转成base64</span></span><br><span class="line">                limit: <span class="number">10240</span>,</span><br><span class="line">                <span class="comment">// 打包后的文件夹</span></span><br><span class="line">                outputPath: <span class="string">'img'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            loader: <span class="string">'image-webpack-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">                <span class="comment">// 设置对jpg格式的图片压缩的程度设置</span></span><br><span class="line">                mozjpeg: &#123;</span><br><span class="line">                    progressive: <span class="literal">true</span>,</span><br><span class="line">                    quality: <span class="number">65</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h2><p>在config目录下新建 plugins.js 文件</p>
<p>代码如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="comment">// 生成html页面</span></span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="comment">// 删除某些东西</span></span><br><span class="line"><span class="keyword">const</span> CleanWebpackPlugin = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"><span class="comment">// 处理静态资源,静态资源输出</span></span><br><span class="line"><span class="keyword">const</span> CopyWebpackPlugin = <span class="built_in">require</span>(<span class="string">'copy-webpack-plugin'</span>)</span><br><span class="line"><span class="comment">// 引入webpack</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="comment">// 提取css</span></span><br><span class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>)</span><br><span class="line"><span class="comment">// 删除冗余css代码</span></span><br><span class="line"><span class="keyword">const</span> PurifyCssWebpack = <span class="built_in">require</span>(<span class="string">'purifycss-webpack'</span>)</span><br><span class="line"><span class="comment">// 用于获取指定文件夹下的文件</span></span><br><span class="line"><span class="keyword">const</span> glob = <span class="built_in">require</span>(<span class="string">'glob'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = [</span><br><span class="line">    <span class="comment">// 生成多个页面需要调用多次new HtmlWebpackPlugin() 多页面的配置</span></span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        <span class="comment">// 生成多个页面,filename作为标识</span></span><br><span class="line">        filename: <span class="string">'index.html'</span>,</span><br><span class="line">        <span class="comment">// 多页面引入自己的js</span></span><br><span class="line">        <span class="comment">// chunks:['index'],</span></span><br><span class="line">        <span class="comment">// 自定义模板标题</span></span><br><span class="line">        <span class="comment">// 模板页title定义为 &lt;%= htmlWebpackPlugin.options.title %&gt;</span></span><br><span class="line">        <span class="comment">// 必须这么写htmlWebpackPlugin</span></span><br><span class="line">        title: <span class="string">'hello world'</span>,</span><br><span class="line">        <span class="comment">// 模板</span></span><br><span class="line">        template: <span class="string">'./src/index.html'</span>,</span><br><span class="line">        <span class="comment">// 生成的文件消除缓存</span></span><br><span class="line">        hash: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 压缩输出</span></span><br><span class="line">        minify: &#123;</span><br><span class="line">            <span class="comment">// 删除空白字符(折叠空白区域)</span></span><br><span class="line">            <span class="comment">// collapseWhitespace:true,</span></span><br><span class="line">            <span class="comment">// 删除属性的双引号</span></span><br><span class="line">            <span class="comment">// removeAttributeQuotes:true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> CleanWebpackPlugin([<span class="string">'dist'</span>]),</span><br><span class="line">    <span class="comment">// 静态资源输出</span></span><br><span class="line">    <span class="keyword">new</span> CopyWebpackPlugin([&#123;</span><br><span class="line">        <span class="comment">// 初始文件夹</span></span><br><span class="line">        <span class="keyword">from</span>: path.resolve(__dirname, <span class="string">'../src/asset'</span>),</span><br><span class="line">        <span class="comment">// 目标文件夹</span></span><br><span class="line">        to: <span class="string">'./public'</span></span><br><span class="line">    &#125;]),</span><br><span class="line">    <span class="comment">// 使用热更新</span></span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin(),</span><br><span class="line">    <span class="comment">// 提取css</span></span><br><span class="line">    <span class="keyword">new</span> ExtractTextPlugin(&#123;</span><br><span class="line">        filename: <span class="string">'css/[name].css'</span>,</span><br><span class="line">        <span class="comment">// 根据不同环境走不同的配置（在开发环境下不使用）</span></span><br><span class="line">        disable: process.env.NODE_ENV === <span class="string">"development"</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 删除冗余css代码</span></span><br><span class="line">    <span class="keyword">new</span> PurifyCssWebpack(&#123;</span><br><span class="line">        <span class="comment">// purifycss会根据配置的路劲遍历你的HTML文件，查找你使用的CSS</span></span><br><span class="line">        paths: glob.sync(path.join(__dirname, <span class="string">'src/*.html'</span>)),</span><br><span class="line">        minimize: <span class="literal">true</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 向全局暴露第三方库</span></span><br><span class="line">    <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">        $: <span class="string">'jquery'</span>,</span><br><span class="line">        jQuery: <span class="string">'jquery'</span></span><br><span class="line">    &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure></div>

<h2 id="devServer"><a href="#devServer" class="headerlink" title="devServer"></a>devServer</h2><p>在config目录下新建 devServer.js 文件</p>
<p>代码如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 设置服务器访问的基本目录</span></span><br><span class="line">    contentBase: path.resolve(__dirname, <span class="string">'../dist'</span>),</span><br><span class="line">    <span class="comment">// 设置开发服务器的地址</span></span><br><span class="line">    host: <span class="string">'localhost'</span>,</span><br><span class="line">    <span class="comment">// 设置开发服务器的端口</span></span><br><span class="line">    port: <span class="number">8080</span>,</span><br><span class="line">    <span class="comment">// 自动打开浏览器</span></span><br><span class="line">    open: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 配置热更新</span></span><br><span class="line">    hot: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="optimization"><a href="#optimization" class="headerlink" title="optimization"></a>optimization</h2><p>在config目录下新建 optimization.js 文件</p>
<p>代码如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">        cacheGroups: &#123;</span><br><span class="line">            <span class="comment">// 这会创建一个vendor代码块，这个代码块包含所有被其他入口(entrypoints)共享的代码。</span></span><br><span class="line">            vendor: &#123;</span><br><span class="line">                test: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                chunks: <span class="string">'initial'</span>,</span><br><span class="line">                name: <span class="string">'vendor'</span>,</span><br><span class="line">                priority: <span class="number">10</span>,</span><br><span class="line">                enforce: <span class="literal">true</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 为每一个入口默认添加一个只包含 runtime 的 chunk</span></span><br><span class="line">    runtimeChunk: &#123;</span><br><span class="line">        name: <span class="string">'runtime'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="webpack-config-js"><a href="#webpack-config-js" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h2><p>再看看我们的webpack.config.js 文件</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> entry = <span class="built_in">require</span>(<span class="string">'./config/entry'</span>)</span><br><span class="line"><span class="keyword">const</span> output = <span class="built_in">require</span>(<span class="string">'./config/output'</span>)</span><br><span class="line"><span class="keyword">const</span> modules = <span class="built_in">require</span>(<span class="string">'./config/modules'</span>)</span><br><span class="line"><span class="keyword">const</span> plugins = <span class="built_in">require</span>(<span class="string">'./config/plugins'</span>)</span><br><span class="line"><span class="keyword">const</span> devServer = <span class="built_in">require</span>(<span class="string">'./config/devServer'</span>)</span><br><span class="line"><span class="keyword">const</span> optimization = <span class="built_in">require</span>(<span class="string">'./config/optimization'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 入口配置</span></span><br><span class="line">    entry,</span><br><span class="line">    <span class="comment">// 出口文件</span></span><br><span class="line">    output,</span><br><span class="line">    <span class="built_in">module</span>: modules,</span><br><span class="line">    plugins,</span><br><span class="line">    <span class="comment">// 开发服务器</span></span><br><span class="line">    devServer,</span><br><span class="line">    optimization</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>npm run dev 测试一下，发现和以前的没有区别就成功啦</p>
<p>前面讲了这么多，然后发现和以前一点区别都没有，是不是很像拍死我了，亏我看了大半个钟，然而啥也没学到。</p>
<p>别着急嘛，你在看看我们模块化之后，主文件是不是简单了许多，而且排错也更加的方便直观了</p>
<h1 id="多页面构建（正题）"><a href="#多页面构建（正题）" class="headerlink" title="多页面构建（正题）"></a>多页面构建（正题）</h1><p>既然已经实现了模块化，我们接下来就说说多页面吧，也是时候进入正题了</p>
<p>上次我们说到，多次new HtmlWebpackPlugin()就可以生成多个页面了，但是如果我们有20来个页面，new个20多次，实属不是很优雅，所以我们想看有没有一个方法，根据我们传进去的路径就可以生成我们制定的页面呢？当然是可以的。不过既然是多页面那么肯定就是多入口的，因为webpack是以js为入口的，所以我们需要在entry那里定义我们的入口即可</p>
<p>打开entry.js，并修改entry的代码</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> glob = <span class="built_in">require</span>(<span class="string">'glob'</span>)</span><br><span class="line"><span class="comment">// 获取所有入口文件</span></span><br><span class="line"><span class="keyword">const</span> getEntry = <span class="function"><span class="keyword">function</span> (<span class="params">globPath</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> entries = &#123;&#125;;</span><br><span class="line">    glob.sync(globPath).forEach(<span class="function"><span class="keyword">function</span> (<span class="params">entry</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> pathname = entry.split(<span class="string">'/'</span>).splice(<span class="number">-1</span>).join(<span class="string">'/'</span>).split(<span class="string">'.'</span>)[<span class="number">0</span>];</span><br><span class="line">        entries[pathname] = [entry];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> entries;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> entries = getEntry(<span class="string">'./src/static/js/*.js'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = entries</span><br></pre></td></tr></table></figure></div>

<p>打开plugins.js，并修改plugins的代码</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">plugins = [</span><br><span class="line">    --w HtmlWebpackPlugin(&#123;</span><br><span class="line">    --  filename: <span class="string">'index.html'</span>,</span><br><span class="line">    -- title: <span class="string">'hello world'</span>,</span><br><span class="line">    --  template: <span class="string">'./src/index.html'</span>,</span><br><span class="line">    --  hash: <span class="literal">true</span>,</span><br><span class="line">    --,</span><br><span class="line">    ......</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> entries = <span class="built_in">require</span>(<span class="string">'./entry'</span>)</span><br><span class="line"><span class="keyword">let</span> chunks = <span class="built_in">Object</span>.keys(entries);</span><br><span class="line"><span class="keyword">const</span> metaArr = [&#123;</span><br><span class="line">    charset: <span class="string">'UTF-8'</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    name: <span class="string">'viewport'</span>,</span><br><span class="line">    content: <span class="string">'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0'</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="string">'http-equiv'</span>: <span class="string">'X-UA-Compatible'</span>,</span><br><span class="line">    content: <span class="string">'ie=edge'</span></span><br><span class="line">&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成HTML文件</span></span><br><span class="line">chunks.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">pathname</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (pathname == <span class="string">'vendor'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> conf = &#123;</span><br><span class="line">        <span class="comment">// 输出的文件名</span></span><br><span class="line">        filename: pathname + <span class="string">'.html'</span>,</span><br><span class="line">        <span class="comment">// 引用的模板文件</span></span><br><span class="line">        template: path.resolve(__dirname, <span class="string">'../src/index.html'</span>),</span><br><span class="line">        <span class="comment">// 是否清除缓存</span></span><br><span class="line">        hash: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 页面的js</span></span><br><span class="line">        chunks: [pathname, <span class="string">'runtime'</span>, <span class="string">'vendor'</span>],</span><br><span class="line">        <span class="comment">// 将脚本放在head元素中,默认为body中</span></span><br><span class="line">        <span class="comment">// inject: 'head',</span></span><br><span class="line">        meta: metaArr,</span><br><span class="line">        <span class="comment">// 压缩html</span></span><br><span class="line">        minify: &#123;</span><br><span class="line">            <span class="comment">// 删除空白字符(折叠空白区域)</span></span><br><span class="line">            collapseWhitespace: <span class="literal">true</span>,</span><br><span class="line">            <span class="comment">// 删除属性的双引号</span></span><br><span class="line">            removeAttributeQuotes: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 站点图标</span></span><br><span class="line">        favicon: path.resolve(__dirname, <span class="string">'../src/favicon.ico'</span>)</span><br><span class="line">    &#125;;</span><br><span class="line">    plugins.push(<span class="keyword">new</span> HtmlWebpackPlugin(conf));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = plugins</span><br></pre></td></tr></table></figure></div>

<p>在/src/js目录下新建个about.js来测试下我们写的多页面配置，代码如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'我是about页'</span>);</span><br></pre></td></tr></table></figure></div>

<p>修改/src/index.html,代码如下</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">html</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">htmlWebpackPlugin.options.title</span> %&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"./index.html"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"./about.html"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>运行 npm run dev , 点击2，你会发现跳转到了about页，而且控制台也输出了‘我是about页’，这样我们的多页面配置就算是初步完成了</p>
<h1 id="模板引擎篇"><a href="#模板引擎篇" class="headerlink" title="模板引擎篇"></a>模板引擎篇</h1><p>虽然完成了我们的多页面配置，但是其实你会发现也有很多的不方便啦，像我这么懒的人，肯定是越方便越好</p>
<p>先说说我们的问题，想一个正常的页面，肯定会有很多公共的头部和底部，比如导航栏就是公共的，这时，我们上面的多页面方面，要每次把公共部分写进去，这样就会很麻烦了</p>
<p>如果用过gulp的同学知道有个 gulp-file-include 可以引入公共文件，但是有个缺点，就是导航栏高亮要通过js控制，不能通过传值</p>
<p>我们这里就用 ejs 来解决我们的问题（但是ejs并不能解决我们引入公共头的问题，因为他不支持inclued那种语法），下面会详细说明解决方法</p>
<blockquote>
<p>npm install ejs-loader -S</p>
</blockquote>
<p>首先，因为 html-webpack-plugin 不关心你用的是什么模板引起，只要你export出来的是一份完整的HTML字符串，他就会自动处理了。所以，我们这个这边通过js文件来export一份完整的HTML代码。下面我用index.js和about.js作为例子：</p>
<p>因为我们安装了ejs，配置下ejs-loader，修改下config/modules.js</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    rules:[&#123;</span><br><span class="line">        test: <span class="regexp">/\.ejs$/</span>,</span><br><span class="line">        use: [<span class="string">'ejs-loader'</span>]</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="layout模板篇"><a href="#layout模板篇" class="headerlink" title="layout模板篇"></a>layout模板篇</h2><p>然后修改下我们src目录，既然我们用了ejs，为了方便我们更好的处理，我们需要修改下我们的目录结构了</p>
<p>把src所有目录删除掉，新建 layout、pages、static 目录，从命名来看，layout是放着我们的模板文件，pages放着是我们的页面文件，static放着我们的资源文件</p>
<p>在layout目录下新建layout.ejs文件，内容如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">html</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%=</span> <span class="attr">header</span> %&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%=</span> <span class="attr">content</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%=</span> <span class="attr">footer</span> %&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>从代码来看就知道，header、content、footer都是作为一个变量，然后我们新建header.ejs、footer.ejs作为公共头部和尾部</p>
<p>header.ejs内容如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">html</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span> (<span class="attr">pageTitle</span>) &#123; %&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">pageTitle</span> %&gt;</span><span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">%</span> <span class="attr">navList.forEach</span>(\<span class="attr">function</span>(<span class="attr">item</span>)&#123; %&gt;</span><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"&lt;%=item.url==navName?'active':'' %&gt;"</span>&gt;</span><span class="tag">&lt;<span class="name">%=item.title</span> %&gt;</span> <span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">%</span> &#125;) %&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>header页面的\都去掉，因为Jekyll编译失败，无奈加上</p>
</blockquote>
<p>footer.ejs内容如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">html</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">        <span class="tag">&lt;<span class="name">footer</span>&gt;</span>我是公共底部<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>然后到我们的核心,新建 index.js:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> layout = <span class="built_in">require</span>(<span class="string">'./layout.ejs'</span>);</span><br><span class="line"><span class="keyword">const</span> header = <span class="built_in">require</span>(<span class="string">'./header.ejs'</span>);</span><br><span class="line"><span class="keyword">const</span> footer = <span class="built_in">require</span>(<span class="string">'./footer.ejs'</span>);</span><br><span class="line"><span class="comment">// 这里作为我们需要的参数</span></span><br><span class="line"><span class="keyword">const</span> pf = &#123;</span><br><span class="line">    pageTitle: <span class="string">''</span>,</span><br><span class="line">    navName: <span class="string">''</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> moduleExports = &#123;</span><br><span class="line">    init(&#123;</span><br><span class="line">        pageTitle,</span><br><span class="line">        navName</span><br><span class="line">    &#125;) &#123;</span><br><span class="line">        pf.pageTitle = pageTitle;</span><br><span class="line">        pf.navName = navName;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    run(content) &#123;</span><br><span class="line">        <span class="keyword">const</span> componentRenderData = <span class="built_in">Object</span>.assign(&#123;&#125;, &#123;</span><br><span class="line">            navList: [&#123;</span><br><span class="line">                title: <span class="string">'首页'</span>,</span><br><span class="line">                url: <span class="string">'index'</span></span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                title: <span class="string">'关于我们'</span>,</span><br><span class="line">                url: <span class="string">'about'</span></span><br><span class="line">            &#125;]</span><br><span class="line">        &#125;, pf);</span><br><span class="line">        <span class="keyword">const</span> renderData = &#123;</span><br><span class="line">            header: header(componentRenderData),</span><br><span class="line">            footer: footer(componentRenderData),</span><br><span class="line">            content,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> layout(renderData);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">module</span>.exports = moduleExports;</span><br></pre></td></tr></table></figure></div>

<p>index.js的主要功能就是接收各个页面独有的参数（比如说页面名称），并将这些参数传入生成各自HTML字符串，然后根据layout本身的模板文件将各组件的HTML以及页面实际内容的HTML拼接在一起，最终形成一个完整的HTML页面文档。</p>
<h2 id="pages页面篇"><a href="#pages页面篇" class="headerlink" title="pages页面篇"></a>pages页面篇</h2><p>在我们之前新建的pages目录下新建我们的页面目录，这里我们新建index和about目录，为什么新建是因为我们需要用他们各自的js到处完整的HTML字符串（上面也说了），接下啦就是开始干正事了</p>
<p>在index目录下新建 index.ejs 和 index.js 文件</p>
<p>index.ejs主要负责layout模板中的content内容，主要是页面内容：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">html</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"h1"</span>&gt;</span>我是首页<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"$&#123;require('../../static/img/1.jpg')&#125;"</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>index.js 主要是负责导出页面的字符串</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> content = <span class="built_in">require</span>(<span class="string">'./index.ejs'</span>);</span><br><span class="line"><span class="keyword">const</span> layout = <span class="built_in">require</span>(<span class="string">'../../layout'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = layout.init(&#123;</span><br><span class="line">    pageTitle: <span class="string">'首页'</span>,</span><br><span class="line">    navName: <span class="string">'index'</span></span><br><span class="line">&#125;).run(content());</span><br></pre></td></tr></table></figure></div>

<p>做了这些处理之后，会发现我们的入口文件发生了改变，这样子就需要修改我们的入口配置文件了，打开config/entry.js文件</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">--<span class="keyword">const</span> entries = getEntry(<span class="string">'./src/js/*.js'</span>)</span><br><span class="line"><span class="keyword">const</span> entries = getEntry(<span class="string">'./src/static/js/*.js'</span>)</span><br></pre></td></tr></table></figure></div>

<p>也是因为我们使用js为入口，修改下config下的modules.js和plugins.js文件</p>
<p>modules.js</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    rules : [&#123;</span><br><span class="line">            --exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">            include: [</span><br><span class="line">                path.resolve(__dirname, <span class="string">'../src/static/js'</span>)</span><br><span class="line">            ]</span><br><span class="line">        &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>plugins.js</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 修改template</span></span><br><span class="line">template: path.resolve(__dirname, <span class="string">'../src/pages/'</span> + pathname + <span class="string">'/'</span> + pathname + <span class="string">'.js'</span>),</span><br></pre></td></tr></table></figure></div>

<p>然后运行npm run dev 发现和之前没有变化 O(∩_∩)O 这样就基本完成多页面的配置了</p>
<h1 id="掉坑篇"><a href="#掉坑篇" class="headerlink" title="掉坑篇"></a>掉坑篇</h1><h2 id="css-loader的坑"><a href="#css-loader的坑" class="headerlink" title="css-loader的坑"></a>css-loader的坑</h2><p>因为css-loader升级到1.0.0版本之后，压缩就失效了，css-loader把cssnano移除掉了，导致无法压缩，这里作者推荐的其中一个解决方案是@intervolga/optimize-cssnano-plugin</p>
<p>这里我们安装一下</p>
<blockquote>
<p>npm i @intervolga/optimize-cssnano-plugin -S</p>
</blockquote>
<p>然后在plugins.js添加下配置，修改如下:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 解决css压缩</span></span><br><span class="line"><span class="keyword">const</span> OptimizeCssnanoPlugin = <span class="built_in">require</span>(<span class="string">'@intervolga/optimize-cssnano-plugin'</span>);</span><br><span class="line">plugins = [</span><br><span class="line">    ......</span><br><span class="line">    <span class="keyword">new</span> OptimizeCssnanoPlugin(&#123;</span><br><span class="line">        <span class="comment">// sourceMap: nextSourceMap,</span></span><br><span class="line">        cssnanoOptions: &#123;</span><br><span class="line">            preset: [<span class="string">'default'</span>, &#123;</span><br><span class="line">                discardComments: &#123;</span><br><span class="line">                    removeAll: <span class="literal">true</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;],</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure></div>

<h2 id="字体文件的坑"><a href="#字体文件的坑" class="headerlink" title="字体文件的坑"></a>字体文件的坑</h2><p>因为我们很经常用bootstrap这种UI库，所以我们引入这种库报个需要一个loader处理这种字体文件，所以我们修改下modules.js文件</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">     rules:[&#123;</span><br><span class="line">        test: <span class="regexp">/\.(gif|jpg|png|woff|svg|eot|ttf)\??.*$/</span>,</span><br><span class="line">        use: [&#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">                <span class="comment">// 小于10kb转成base64</span></span><br><span class="line">                limit: <span class="number">10240</span>,</span><br><span class="line">                <span class="comment">// 打包后的文件夹</span></span><br><span class="line">                outputPath: <span class="string">'img'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            loader: <span class="string">'image-webpack-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">                <span class="comment">// 设置对jpg格式的图片压缩的程度设置</span></span><br><span class="line">                mozjpeg: &#123;</span><br><span class="line">                    progressive: <span class="literal">true</span>,</span><br><span class="line">                    quality: <span class="number">65</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="优化篇"><a href="#优化篇" class="headerlink" title="优化篇"></a>优化篇</h1><h2 id="babel优化"><a href="#babel优化" class="headerlink" title="babel优化"></a>babel优化</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">json</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [</span><br><span class="line">    [<span class="string">"env"</span>, &#123;</span><br><span class="line">      <span class="attr">"modules"</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">"targets"</span>: &#123;</span><br><span class="line">        <span class="attr">"browsers"</span>: [<span class="string">"&gt; 1%"</span>, <span class="string">"last 2 versions"</span>, <span class="string">"not ie &lt;= 8"</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">"stage-2"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"plugins"</span>: [<span class="string">"transform-object-assign"</span>, <span class="string">"transform-runtime"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>虽然我们之前那个对于const、let这些常用es6可以转成es5，但对于Object.assign这些还是不行，我们这里优化一下我们之前的babel，安装下面依赖</p>
<blockquote>
<p>npm install babel-plugin-transform-object-assign babel-preset-stage-2 babel-plugin-transform-runtime -S</p>
</blockquote>
<h2 id="DllPlugin"><a href="#DllPlugin" class="headerlink" title="DllPlugin"></a>DllPlugin</h2><p>DllPlugin 是什么？从官方的说法就是，DLLPlugin 和 DLLReferencePlugin 用某种方法实现了拆分 bundles，同时还大大提升了构建的速度。简单来说，就是webpack的动态链接库，这里的代码不会执行，只是提供给我们引入。</p>
<p>实际就是，我们引入了多个相对较大的库（比如，bootstrap，loadsh，jquery），但是我们又不怎么需要修改他们，就可以用 DLLPlugin 打包了。</p>
<p>新建 webpack-dll.config.js 文件，代码如下</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="comment">// 文件处理器</span></span><br><span class="line"><span class="keyword">const</span> modules = <span class="built_in">require</span>(<span class="string">'./config/modules'</span>)</span><br><span class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>);</span><br><span class="line"><span class="comment">// 解决css压缩</span></span><br><span class="line"><span class="keyword">const</span> OptimizeCssnanoPlugin = <span class="built_in">require</span>(<span class="string">'@intervolga/optimize-cssnano-plugin'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 入口配置</span></span><br><span class="line">    entry: &#123;</span><br><span class="line">        comment: [<span class="string">'jquery'</span>, <span class="string">'./vendor/css/comment.css'</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 出口文件</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.join(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        filename: <span class="string">'js/[name].js'</span>,</span><br><span class="line">        library: <span class="string">'[name]'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// module.rules</span></span><br><span class="line">    <span class="comment">// loaders</span></span><br><span class="line">    <span class="built_in">module</span>: modules,</span><br><span class="line">    <span class="comment">// 插件</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.DllPlugin(&#123;</span><br><span class="line">            path: path.join(__dirname, <span class="string">'./manifest.json'</span>),</span><br><span class="line">            name: <span class="string">'[name]'</span>,</span><br><span class="line">            context: __dirname,</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 向全局暴露第三方库</span></span><br><span class="line">        <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">            $: <span class="string">'jquery'</span>,</span><br><span class="line">            jQuery: <span class="string">'jquery'</span>,</span><br><span class="line">            <span class="string">'window.$'</span>: <span class="string">'jquery'</span>,</span><br><span class="line">            <span class="string">'window.jQuery'</span>: <span class="string">'jquery'</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> ExtractTextPlugin(<span class="string">'css/[name].css'</span>),</span><br><span class="line">        <span class="keyword">new</span> OptimizeCssnanoPlugin(&#123;</span><br><span class="line">            <span class="comment">// sourceMap: nextSourceMap,</span></span><br><span class="line">            cssnanoOptions: &#123;</span><br><span class="line">                preset: [<span class="string">'default'</span>, &#123;</span><br><span class="line">                    discardComments: &#123;</span><br><span class="line">                        removeAll: <span class="literal">true</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;],</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>这里是不是发现模块化的好处了，我们可以调用之前写好的模块配置，既节省了代码，也方便修改</p>
<p>再 package.json 配置一下我们的启动命令，</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">"srcipt"</span>: &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="string">"dll"</span>: <span class="string">"webpack --progress --colors --config ./webpack-dll.config.js --mode production"</span>,</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>运行 npm run dll 这样就会生成 manifest.json 文件了，也就是我们webpack动态依赖库</p>
<p>配置了我们的动态依赖库之后，我们也需要在我们webpack.config.js中引入我们的依赖库，这里我们在config/plugins.js中修改即可</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> plugins = [</span><br><span class="line">    <span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">        context: staticRootDir,</span><br><span class="line">        manifest: <span class="built_in">require</span>(<span class="string">'../manifest.json'</span>),</span><br><span class="line">        name: <span class="string">'comment'</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure></div>

<h3 id="webpack-dll-config-js存在的问题"><a href="#webpack-dll-config-js存在的问题" class="headerlink" title="webpack-dll.config.js存在的问题"></a>webpack-dll.config.js存在的问题</h3><p>虽然说 DllPlugin 的东西是不常修改的，但是如果我们就是要修改呢，那就需要删除我们的动态库，重新生成一份</p>
<p>手动删除是在不符合我这种懒人，这时候我们就需要使用出我们强大的node啦，新建一个 delete.js 文件</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="comment">// 通过child_process的exex执行命令行命令</span></span><br><span class="line"><span class="keyword">const</span> &#123; exec &#125; = <span class="built_in">require</span>(<span class="string">'child_process'</span>)</span><br><span class="line">fs.unlink(<span class="string">'./manifest.json'</span>, (err) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'成功删除 manifest.json'</span>);</span><br><span class="line">    <span class="comment">// 删除后重新npm run dll</span></span><br><span class="line">    exec(<span class="string">`npm run dll`</span>, (error, stdout, stderr) =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`stdout: <span class="subst">$&#123;stdout&#125;</span>`</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div>

<p>这样就实现了我们删除 manifest.json 后，自动执行dll了</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><blockquote>
<p><a href="https://gitee.com/gating/webpack-pages/" target="_blank" rel="noopener">项目传送门</a></p>
</blockquote>
<p>学到这里，我想已经大概已经怎么使用webpack多页面了，当然，其实还有好多依然讲的很基础，但是我相信，一步一步来，遇到坑填坑，总会学习到更多东西的。</p>
<p>本篇webpack多页面入门文章到此结束 O(∩_∩)O~</p>
<p>最后，感谢各位观众老爷观看</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">gating</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://gatings.cn/2018-08-22/webpack%E4%BB%8E%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%88%B0%E5%A4%9A%E9%A1%B5%E9%9D%A2/">https://gatings.cn/2018-08-22/webpack%E4%BB%8E%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%88%B0%E5%A4%9A%E9%A1%B5%E9%9D%A2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://gatings.cn">磨蹭先生</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/webpack/">webpack    </a></div><div class="post_share"></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://cdn.jsdelivr.net/gh/GATING/blog_imgs@master/blog/wechat.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://cdn.jsdelivr.net/gh/GATING/blog_imgs@master/blog/alipay.jpg" alt="支付宝"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2018-10-24/awardRotate%E8%BD%AC%E7%9B%98%E6%8F%92%E4%BB%B6%E6%96%87%E5%AD%97%E6%A8%A1%E7%B3%8A%E9%97%AE%E9%A2%98%E5%92%8C%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD%E9%97%AE%E9%A2%98/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>awardRotate转盘插件文字模糊问题和图片加载问题</span></div></a></div><div class="next-post pull_right"><a href="/2018-06-15/webpack%E4%BB%8E%E4%BB%80%E4%B9%88%E9%83%BD%E4%B8%8D%E6%87%82%E5%88%B0%E5%85%A5%E9%97%A8/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>webpack从什么都不懂到入门</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2018-06-15/webpack从什么都不懂到入门/" title="webpack从什么都不懂到入门"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2018-06-15</div><div class="relatedPosts_title">webpack从什么都不懂到入门</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="lv-container" data-id="city" data-uid="MTAyMC8zNTA5MC8xMTYyNQ=="><script>(function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
})(document, 'script');</script></div></div></div></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2020 By gating</div><div class="footer_custom_text">由<b>&nbsp;磨蹭&nbsp;</b>倾力打造&nbsp;|&nbsp;<b>女王大人</b>&nbsp;-&nbsp;热情赞助</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/click_heart.js"></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>