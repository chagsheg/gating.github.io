<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5"><title>手把手教你写一个符合自己需求的小程序日历组件 | 磨蹭先生</title><meta name="description" content="很多时候，我们生活中会有各种打卡的情况，比如keep的运动打卡、单词的学习打卡和各种签到打卡或者酒店的入住时间选择，这时候就需要我们书写一个日历组件来处理我们这种需求。"><meta name="keywords" content="小程序"><meta name="author" content="gating"><meta name="copyright" content="gating"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/GATING/blog_imgs@master/blog/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://hm.baidu.com"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="手把手教你写一个符合自己需求的小程序日历组件"><meta name="twitter:description" content="很多时候，我们生活中会有各种打卡的情况，比如keep的运动打卡、单词的学习打卡和各种签到打卡或者酒店的入住时间选择，这时候就需要我们书写一个日历组件来处理我们这种需求。"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta property="og:type" content="article"><meta property="og:title" content="手把手教你写一个符合自己需求的小程序日历组件"><meta property="og:url" content="https://gatings.cn/2020-06-08/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E5%86%99%E4%B8%80%E4%B8%AA%E7%AC%A6%E5%90%88%E8%87%AA%E5%B7%B1%E9%9C%80%E6%B1%82%E7%9A%84%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%97%A5%E5%8E%86%E7%BB%84%E4%BB%B6/"><meta property="og:site_name" content="磨蹭先生"><meta property="og:description" content="很多时候，我们生活中会有各种打卡的情况，比如keep的运动打卡、单词的学习打卡和各种签到打卡或者酒店的入住时间选择，这时候就需要我们书写一个日历组件来处理我们这种需求。"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode="1";var t=Cookies.get("theme");{const e=window.matchMedia("(prefers-color-scheme: dark)").matches,o=window.matchMedia("(prefers-color-scheme: light)").matches,a=window.matchMedia("(prefers-color-scheme: no-preference)").matches,c=!e&&!o&&!a;void 0===t?o?activateLightMode():e?activateDarkMode():(a||c)&&(console.log("You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time."),now=new Date,hour=now.getHours(),isNight=hour<6||hour>=18,isNight?activateDarkMode():activateLightMode()):"light"==t?activateLightMode():activateDarkMode()}function activateDarkMode(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#000")}function activateLightMode(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#fff")}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://gatings.cn/2020-06-08/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E5%86%99%E4%B8%80%E4%B8%AA%E7%AC%A6%E5%90%88%E8%87%AA%E5%B7%B1%E9%9C%80%E6%B1%82%E7%9A%84%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%97%A5%E5%8E%86%E7%BB%84%E4%BB%B6/"><link rel="prev" title="node实现图片四周填充透明区域" href="https://gatings.cn/2020-06-10/node%E5%9B%BE%E7%89%87%E5%9B%9B%E5%91%A8%E5%A1%AB%E5%85%85%E9%80%8F%E6%98%8E%E5%8C%BA%E5%9F%9F/"><link rel="next" title="Charles（青花瓷/花瓶）的基本使用" href="https://gatings.cn/2020-06-04/Charles%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?914d8fcbdf614fcc92017b47706d7bee";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容:${query}"}},translate:{defaultEncoding:2,translateDelay:0,cookieDomain:"https://gatings.cn/",msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"简"},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},bookmark:{title:"Snackbar.bookmark.title",message_prev:"按",message_next:"键将本页加入书签"},runtime_unit:"天",runtime:!0,copyright:void 0,ClickShowText:void 0,medium_zoom:!0,fancybox:!0,Snackbar:{bookmark:{title:"Snackbar.bookmark.title",message_prev:"按",message_next:"键将本页加入书签"},chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#2d3035",position:"bottom-left"},baiduPush:!0,isHome:!1,isPost:!0}</script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="磨蹭先生" type="application/atom+xml">
</head><body><header><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">磨蹭先生</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/GATING/blog_imgs@master/blog/avatar.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">38</div></a></div></div><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">18</div></a></div></div><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">8</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#前言"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">前言</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#准备工作"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">准备工作</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#编写代码"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">编写代码</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#思考一下"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text">思考一下</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#小-tips"><span class="toc_mobile_items-number">3.1.1.</span> <span class="toc_mobile_items-text">小 tips</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#正式开始编写代码"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text">正式开始编写代码</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#无缝滑动思考"><span class="toc_mobile_items-number">3.3.</span> <span class="toc_mobile_items-text">无缝滑动思考</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#如何区分左滑右滑（上滑下滑）"><span class="toc_mobile_items-number">3.4.</span> <span class="toc_mobile_items-text">如何区分左滑右滑（上滑下滑）</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#正式书写我们可滑动的日历组件"><span class="toc_mobile_items-number">3.5.</span> <span class="toc_mobile_items-text">正式书写我们可滑动的日历组件</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#最后"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">最后</span></a></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#准备工作"><span class="toc-number">2.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#编写代码"><span class="toc-number">3.</span> <span class="toc-text">编写代码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#思考一下"><span class="toc-number">3.1.</span> <span class="toc-text">思考一下</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#小-tips"><span class="toc-number">3.1.1.</span> <span class="toc-text">小 tips</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#正式开始编写代码"><span class="toc-number">3.2.</span> <span class="toc-text">正式开始编写代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#无缝滑动思考"><span class="toc-number">3.3.</span> <span class="toc-text">无缝滑动思考</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何区分左滑右滑（上滑下滑）"><span class="toc-number">3.4.</span> <span class="toc-text">如何区分左滑右滑（上滑下滑）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#正式书写我们可滑动的日历组件"><span class="toc-number">3.5.</span> <span class="toc-text">正式书写我们可滑动的日历组件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#最后"><span class="toc-number">4.</span> <span class="toc-text">最后</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image:url(https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png)"><div id="post-info"><div id="post-title"><div class="posttitle">手把手教你写一个符合自己需求的小程序日历组件</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2020-06-08<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-11-03</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/">小程序</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon fa-fw" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">4.9k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon fa-fw" aria-hidden="true"></i><span>阅读时长: 20 分钟</span><div class="post-meta-pv-cv"><span class="post-meta__separator">|</span><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>很多时候，我们生活中会有各种打卡的情况，比如 keep 的运动打卡、单词的学习打卡和各种签到打卡或者酒店的入住时间选择，这时候就需要我们书写一个日历组件来处理我们这种需求。</p><p>但是更多时候，我们都是网上找一个插件直接套用了，有没有想过自己实现一下呢？如果有，但是感觉不太会的话，接下来跟着我一起实现符合自己需求的日历吧</p><h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><p>因为我们是小程序日历嘛，所以必不可少的肯定是微信开发者工具啦。项目目录结构如下：</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">|-- calendar</span><br><span class="line">    |-- app.js</span><br><span class="line">    |-- app.json</span><br><span class="line">    |-- app.wxss</span><br><span class="line">    |-- project.config.json</span><br><span class="line">    |-- sitemap.json</span><br><span class="line">    |-- components</span><br><span class="line">    |   |-- calendar</span><br><span class="line">    |       |-- index.js</span><br><span class="line">    |       |-- index.json</span><br><span class="line">    |       |-- index.wxml</span><br><span class="line">    |       |-- index.wxss</span><br><span class="line">    |-- pages</span><br><span class="line">        |-- index</span><br><span class="line">            |-- index.js</span><br><span class="line">            |-- index.json</span><br><span class="line">            |-- index.wxml</span><br><span class="line">            |-- index.wxss</span><br></pre></td></tr></table></figure></div><p>使用 <code>git</code> 下载空白模板:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> -b calendar  https://gitee.com/gating/demo.git</span><br></pre></td></tr></table></figure></div><blockquote><p>ps: 下面步骤有点啰嗦，如果看目录结构就能懂的话就不需要跟着步骤啦</p></blockquote><ol><li><p>新建一个名为<code>calendar</code>的空文件夹</p></li><li><p>打卡<code>微信开发者工具</code>，新增项目，选中刚刚创建的<code>calendar</code>文件夹，开发模式选中小程序，AppID 使用测试号即可，如图所示：<br><a href="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2020-06-08/calendar01.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption="新建calendar项目" class="fancybox"><img alt="新建calendar项目" title="新建calendar项目" data-src="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2020-06-08/calendar01.jpg" class="lazyload"></a></p></li><li><p>创建完后，开发者工具会默认帮我们生成默认的代码，我们在当前文件夹新增<code>components</code>文件家，再在<code>components</code>文件夹中新增<code>calendar</code>文件夹，再从当前文件夹新增名为<code>index</code>的组件，如图：</p><p><a href="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2020-06-08/calendar02.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption="新建calendar组件" class="fancybox"><img alt="新建calendar组件" title="新建calendar组件" data-src="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2020-06-08/calendar02.jpg" class="lazyload"></a></p></li></ol><blockquote><p>ps:因为开发者工具会默认生成初始代码，所以直接使用他创建组件比较方便</p></blockquote><ol start="4"><li>删除一些和本次博文无关的代码，比如<code>app.js</code>中的本地缓存能力，具体参考空白模板</li></ol><h1 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h1><p>接下来编写代码部分我们直接在<code>VSCode</code>编写，因为<code>微信开发者工具</code>实在太。。。- -所以还是使用<code>VSCode</code>编写比较合适</p><h2 id="思考一下"><a href="#思考一下" class="headerlink" title="思考一下"></a>思考一下</h2><p>想要实现日历，我们需要知道几个小知识：</p><ol><li><p>根据常识，我们知道一个月最少有 28 天，最多有 31 天，一周有 7 天，那么就可以有 5 排，但如果有一个月的第一天为星期六且当月有 31 天，那么他就会有 6 排格子才对。比如<code>2020年8月</code>，如图所示：</p><p><a href="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2020-06-08/calendar03.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption="2020年8月" class="fancybox"><img alt="2020年8月" title="2020年8月" data-src="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2020-06-08/calendar03.jpg" class="lazyload"></a></p></li></ol><p>2) 我们需要知道，当月的第一天是周几</p><p>3) 我们需要知道，当月有多少天</p><p>4) 最重要的是小程序没有 DOM 操作概念，所以我们不能动态往当月第一天插入格子，所以只能根据第一天是周几循环插入格子</p><p>知道以上四点后，我们就可以编写我们的代码啦</p><p>首先，第二第三点是最简单的，我先书写第二第三点，怎么获取当前是周几呢？其实<code>js</code>的<code>Date</code>对象直接有现成的方法，我们直接拿来用就好了</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">Javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">"今天是星期"</span> + <span class="keyword">new</span> <span class="built_in">Date</span>().getDay());</span><br></pre></td></tr></table></figure></div><p>我想有点小难度的是第三点，获取当月有多少天，因为你想，其他的月份的天数是固定的，唯独 2 月，在平年和闰年的不同年份中，2 月的天数也是不同的，那么有没有简单的方法获取当月有多少天呢，其实也是有的，<code>Date</code>实例中的<code>getDate</code>就可以实现我们想要的效果了</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">Javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取一个月有多少天</span></span><br><span class="line"><span class="keyword">const</span> getMonthDays = <span class="function">(<span class="params">year, month</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> days = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month + <span class="number">1</span>, <span class="number">0</span>).getDate();</span><br><span class="line">  <span class="keyword">return</span> days;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><p>我们通过 <code>Date</code> 的第三个参数传 0 就可以获取上个月的最后一天，最后通过 <code>getDate()</code> 获取它的日期就可以对应我们当月的天数，那么就不需要我们自己处理平年和闰年的 2 月有多少天了</p><blockquote><p>是不是又学到了小知识点呢？</p></blockquote><p>解决了 2.3 两个问题，我们就可以往下书写我们的日历了。</p><p>众所周知，小程序规定宽度为<code>750rpx</code>(<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxss.html" target="_blank" rel="noopener">尺寸单位</a>)，而我们的一周有 7 天，即 7 格，那么就是每个格子的宽度为<code>107rpx</code>，不建议使用小数，因为 rpx 计算的时候，遇到小数会存在少量偏差。这里我们使用<code>flex</code>布局解决。</p><p>所以接下来就可以写我们的布局和生成我们的数据啦，从上面我们分析了，我们有 6 排格子，一排有 7 个，也就是一共 42 个格子。即需要遍历 42 次</p><p>先定义一下我们所需要的数据，便于我们后续操作：</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">json</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"dataStr"</span>: <span class="string">"2020/06/08"</span>,</span><br><span class="line">    <span class="attr">"day"</span>: <span class="string">"08"</span>,</span><br><span class="line">    <span class="attr">"month"</span>: <span class="string">"08"</span>,</span><br><span class="line">    <span class="attr">"otherMonth"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"today"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"year"</span>: <span class="number">2020</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></div><blockquote><p>这里我只定义个几个简单的基本数据，如果有不同的业务场景可以自行添加基础数据</p></blockquote><h3 id="小-tips"><a href="#小-tips" class="headerlink" title="小 tips"></a>小 tips</h3><p>IOS 端的日期格式必须为<code>/</code>才可以转化为日期格式，比如<code>2018/07/08</code>，而<code>2018-07-08</code>则返回<code>Invalid Date</code>，所以我们需要把<code>-</code>都替换为<code>/</code>。</p><p>不单单是小程序，微信公众号，safari 都是一样的。</p><h2 id="正式开始编写代码"><a href="#正式开始编写代码" class="headerlink" title="正式开始编写代码"></a>正式开始编写代码</h2><p>那么就可以写我们的 js 代码了，在 <code>components -&gt; calendar</code>目录下新建<code>utils.js</code>文件，书写我们创建数据的基础方法：</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">Javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取当月有多少天</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String | Number&#125;</span> </span>year =&gt; 年</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String | Number&#125;</span> </span>month =&gt; 月</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> getMonthDays = <span class="function">(<span class="params">year, month</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> days = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month + <span class="number">1</span>, <span class="number">0</span>).getDate();</span><br><span class="line">  <span class="keyword">return</span> days;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 补0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String | Number&#125;</span> <span class="variable">num</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> toDou = <span class="function">(<span class="params">num</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> num &gt; <span class="number">9</span> ? num : <span class="string">"0"</span> + num;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 转换为日期格式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">date</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> transformDate = <span class="function">(<span class="params">date</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!(date <span class="keyword">instanceof</span> <span class="built_in">Date</span>)) &#123;</span><br><span class="line">    date = <span class="keyword">new</span> <span class="built_in">Date</span>(date);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> date;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取当前日期的年月日</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;any&#125;</span> </span>date =&gt; 日期对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> getDateObj = <span class="function">(<span class="params">date</span>) =&gt;</span> &#123;</span><br><span class="line">  date = transformDate(date);</span><br><span class="line">  <span class="keyword">var</span> year = date.getFullYear();</span><br><span class="line">  <span class="keyword">var</span> month = date.getMonth() + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">var</span> day = date.getDate();</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    year,</span><br><span class="line">    month,</span><br><span class="line">    day,</span><br><span class="line">    dataStr: <span class="string">`<span class="subst">$&#123;year&#125;</span>/<span class="subst">$&#123;toDou(month)&#125;</span>/<span class="subst">$&#123;toDou(day)&#125;</span>`</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取当月1号的时间戳</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Date&#125;</span> </span>date =&gt; 日期对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> startOfMonth = <span class="function">(<span class="params">date</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> date.setDate(<span class="number">1</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取今天，导出供组件作为默认值使用</span></span><br><span class="line"><span class="keyword">const</span> &#123; dataStr &#125; = getDateObj(<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成日历数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Date&#125;</span> </span>date =&gt; 日期对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> getDate = <span class="function">(<span class="params">date</span>) =&gt;</span> &#123;</span><br><span class="line">  date = transformDate(date);</span><br><span class="line">  <span class="comment">// 计算需要补的格子</span></span><br><span class="line">  <span class="keyword">let</span> dist;</span><br><span class="line">  <span class="keyword">const</span> &#123; year, month &#125; = getDateObj(date);</span><br><span class="line">  <span class="comment">// 获取当月有多少天</span></span><br><span class="line">  <span class="keyword">const</span> days = getMonthDays(year, month - <span class="number">1</span>);</span><br><span class="line">  <span class="comment">// 获取当前日期是星期几</span></span><br><span class="line">  <span class="keyword">let</span> currentDate = <span class="keyword">new</span> <span class="built_in">Date</span>(startOfMonth(date)).getDay();</span><br><span class="line">  <span class="comment">// 众所周知的原因，一周的第一天时星期天，而我们做的日历星期天是放在最后的，所以我们这里需要改一下值</span></span><br><span class="line">  <span class="keyword">if</span> (currentDate == <span class="number">0</span>) &#123;</span><br><span class="line">    currentDate = <span class="number">7</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  dist = currentDate - <span class="number">1</span>;</span><br><span class="line">  currentDate -= <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">const</span> res = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">42</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// 是否不是当前月</span></span><br><span class="line">    <span class="keyword">const</span> otherMonth = i &gt;= dist + days || i &lt;= currentDate;</span><br><span class="line">    <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month - <span class="number">1</span>, -currentDate + i);</span><br><span class="line">    <span class="keyword">const</span> dateObj = getDateObj(date);</span><br><span class="line">    res.push(&#123;</span><br><span class="line">      ...dateObj,</span><br><span class="line">      today: dataStr === dateObj.dataStr,</span><br><span class="line">      otherMonth,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  getMonthDays,</span><br><span class="line">  toDou,</span><br><span class="line">  getDateObj,</span><br><span class="line">  startOfMonth,</span><br><span class="line">  getDate,</span><br><span class="line">  dataStr,</span><br><span class="line">  transformDate,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><p>这里代码都比较简单，注释也有写，所以就不详细解释了，如有问题就评论，我看到会第一时间回复的。。。。</p><p>在 <code>components -&gt; calendar -&gt; index.js</code> 引入一下 <code>utils.js</code> 文件，然后在<code>created</code>这个生命周期打印一下我们的基础数据，看是否符合预期：</p><p><a href="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2020-06-08/calendar04.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2020-06-08/calendar04.jpg" class="lazyload"></a></p><p>如果你打印的和我打印的一致，那么就可以愉快的写我们组件的界面啦 😄</p><p>因为布局大多数都是样式方面的问题，这里就不多讲解啦，我想大家应该都会的，所以这里直接粘贴代码啦，主要部分我就讲解一下</p><p><code>index.wxml</code>代码如下：</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"calendar-wrapper"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"calendar-controller"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"calendar-picker"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"arrow left"</span> <span class="attr">bindtap</span>=<span class="string">"prevMonth"</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">picker</span></span></span><br><span class="line"><span class="tag">        <span class="attr">mode</span>=<span class="string">'date'</span></span></span><br><span class="line"><span class="tag">        <span class="attr">fields</span>=<span class="string">'month'</span></span></span><br><span class="line"><span class="tag">        <span class="attr">end</span>=<span class="string">"2999-12-31"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">start</span>=<span class="string">"1970-01-01"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">value</span>=<span class="string">"&#123;&#123;monthFormat&#125;&#125;"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">bindchange</span>=<span class="string">"dateChange"</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"month-format"</span>&gt;</span>&#123;&#123;monthFormat&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">picker</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"arrow right"</span> <span class="attr">bindtap</span>=<span class="string">"nextMonth"</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"calendar-header"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"item"</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;week&#125;&#125;"</span> <span class="attr">wx:key</span>=<span class="string">"*this"</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"calendar-container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"item &#123;&#123;item.today?'today':''&#125;&#125; &#123;&#123;item.otherMonth?'other-month':''&#125;&#125;"</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;calendar&#125;&#125;"</span> <span class="attr">wx:key</span>=<span class="string">"dataStr"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123;item.day&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p><code>index.wxss</code>代码如下：</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">css</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.calendar-container</span>,</span><br><span class="line"><span class="selector-class">.calendar-controller</span>,</span><br><span class="line"><span class="selector-class">.calendar-header</span>,</span><br><span class="line"><span class="selector-class">.calendar-picker</span>,</span><br><span class="line"><span class="selector-class">.calendar-container</span> <span class="selector-class">.item</span>,</span><br><span class="line"><span class="selector-class">.calendar-header</span> <span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">line-height</span>: normal;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.calendar-container</span>,</span><br><span class="line"><span class="selector-class">.calendar-controller</span>,</span><br><span class="line"><span class="selector-class">.calendar-header</span> &#123;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-around;</span><br><span class="line">  <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.calendar-container</span> <span class="selector-class">.item</span>,</span><br><span class="line"><span class="selector-class">.calendar-header</span> <span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">107</span>rpx;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">28</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">80</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.calendar-header</span> <span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.calendar-container</span> <span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#111</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.calendar-container</span> <span class="selector-class">.item</span><span class="selector-class">.other-month</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#999</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.calendar-container</span> <span class="selector-class">.item</span><span class="selector-class">.today</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#6190e8</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.calendar-picker</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">30</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#111</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.month-format</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">30</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.arrow</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10</span>rpx <span class="number">15</span>rpx;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#f7f8fc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.arrow</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">14</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">14</span>rpx;</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">4</span>rpx solid <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">border-left</span>: <span class="number">4</span>rpx solid <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.arrow</span><span class="selector-class">.left</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotateY</span>(-<span class="number">45deg</span>) <span class="built_in">rotate</span>(-<span class="number">47deg</span>) <span class="built_in">skew</span>(<span class="number">5deg</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.arrow</span><span class="selector-class">.right</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotateY</span>(-<span class="number">135deg</span>) <span class="built_in">rotate</span>(-<span class="number">47deg</span>) <span class="built_in">skew</span>(<span class="number">5deg</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p><code>index.js</code>代码如下：</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">Javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// components/calendar/index.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; getDate, dataStr, getDateObj &#125; = <span class="built_in">require</span>(<span class="string">"./utils"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getDateStr = <span class="function">(<span class="params">dataStr</span>) =&gt;</span> dataStr.slice(<span class="number">0</span>, <span class="number">-3</span>).replace(<span class="string">"/"</span>, <span class="string">"-"</span>);</span><br><span class="line">Component(&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 组件的属性列表</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  properties: &#123;&#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 组件的初始数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  data: &#123;</span><br><span class="line">    week: [<span class="string">"一"</span>, <span class="string">"二"</span>, <span class="string">"三"</span>, <span class="string">"四"</span>, <span class="string">"五"</span>, <span class="string">"六"</span>, <span class="string">"日"</span>],</span><br><span class="line">    calendar: getDate(<span class="keyword">new</span> <span class="built_in">Date</span>()),</span><br><span class="line">    monthFormat: getDateStr(dataStr),</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 组件的方法列表</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  methods: &#123;</span><br><span class="line">    dateChange(e) &#123;</span><br><span class="line">      <span class="keyword">const</span> monthFormat = e.detail.value;</span><br><span class="line">      <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">        monthFormat,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 上个月日期</span></span><br><span class="line">    prevMonth() &#123;</span><br><span class="line">      <span class="keyword">const</span> [year, month] = <span class="keyword">this</span>.data.monthFormat.split(<span class="string">"-"</span>);</span><br><span class="line">      <span class="keyword">const</span> &#123; dataStr &#125; = getDateObj(</span><br><span class="line">        <span class="keyword">new</span> <span class="built_in">Date</span>(year, month, <span class="number">1</span>).setMonth(month - <span class="number">2</span>)</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">        monthFormat: getDateStr(dataStr),</span><br><span class="line">        calendar: getDate(<span class="keyword">new</span> <span class="built_in">Date</span>(dataStr)),</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 下个月日期</span></span><br><span class="line">    nextMonth() &#123;</span><br><span class="line">      <span class="keyword">const</span> [year, month] = <span class="keyword">this</span>.data.monthFormat.split(<span class="string">"-"</span>);</span><br><span class="line">      <span class="keyword">const</span> &#123; dataStr &#125; = getDateObj(<span class="keyword">new</span> <span class="built_in">Date</span>(year, month, <span class="number">1</span>));</span><br><span class="line">      <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">        monthFormat: getDateStr(dataStr),</span><br><span class="line">        calendar: getDate(<span class="keyword">new</span> <span class="built_in">Date</span>(dataStr)),</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div><blockquote><p>这里的主要迷惑点就是月份，因为我们得到的月份是转换后的（即月份+1），而<code>js</code>中的月份是从 0 开始的，所以我们获取上个月的时候月份就需要<code>-2</code>才能实现我们要的效果，而获取下个月的时候，因为本身我们月份本身就<code>+1</code>了，所以不需要进行操作。</p></blockquote><p>书写完成布局后，大概会得出下面这个日历：</p><p><a href="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2020-06-08/calendar05.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2020-06-08/calendar05.jpg" class="lazyload"></a></p><p>写到这里，其实整个日历的雏形已经出来了，我们可以通过<code>picker</code>换，可以通过点击切换，也算一个相对可以使用的日历组件啦 😝</p><p>但是其实还是远远不够的，毕竟，我们连<strong>手势左右滑动切换日历</strong>这个功能都没有，所以接下来就完善我们这个日历吧</p><h2 id="无缝滑动思考"><a href="#无缝滑动思考" class="headerlink" title="无缝滑动思考"></a>无缝滑动思考</h2><p>你想，既然要做左右滑动切换了，肯定得无缝吧？既然得无缝，肯定不能生成多份吧？那么怎么才能用最少的 DOM 做到无缝呢？答案是我们只需要在我们可视范围内生成 DOM 结构即可，即我们的可视范围就是三份，如图所示：</p><p><a href="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2020-06-08/calendar06.gif" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2020-06-08/calendar06.gif" class="lazyload"></a></p><p>既然说到了<strong>左右滑动</strong>，肯定少不了我们强大的<code>swiper</code>组件啦，我们这次的日历组件就是建立在<code>swiper</code>组件下实现的,既然用到了<code>swiper</code>，那么我们的布局肯定需要进行小改，数据结构也是，需要进行小改动。</p><p>刚才说了，我们的可是范围是三份，所以我们的数据结构就变成了长度为三的数组，即：</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">Javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"calendarArr"</span>: [calendar, calendar, calendar]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>界面也是，我们新增一个<code>swiper</code>组件，然后遍历<code>calendarArr</code>这个数据，</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"calendar-wrapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"calendar-controller"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"calendar-picker"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"arrow left"</span> <span class="attr">bindtap</span>=<span class="string">"prevMonth"</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">picker</span></span></span><br><span class="line"><span class="tag">          <span class="attr">mode</span>=<span class="string">'date'</span></span></span><br><span class="line"><span class="tag">          <span class="attr">fields</span>=<span class="string">'month'</span></span></span><br><span class="line"><span class="tag">          <span class="attr">end</span>=<span class="string">"2999-12-31"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">start</span>=<span class="string">"1970-01-01"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">value</span>=<span class="string">"&#123;&#123;monthFormat&#125;&#125;"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">bindchange</span>=<span class="string">"dateChange"</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"month-format"</span>&gt;</span>&#123;&#123;monthFormat&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">picker</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"arrow right"</span> <span class="attr">bindtap</span>=<span class="string">"nextMonth"</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"calendar-header"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"item"</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;week&#125;&#125;"</span> <span class="attr">wx:key</span>=<span class="string">"*this"</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">swiper</span></span></span><br><span class="line"><span class="tag">      <span class="attr">circular</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"calendar-swiper"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">current</span>=<span class="string">"&#123;&#123;current&#125;&#125;"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">duration</span>=<span class="string">"&#123;&#123;duration&#125;&#125;"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">vertical</span>=<span class="string">"&#123;&#123;isVertical&#125;&#125;"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">skip-hidden-item-layout</span></span></span><br><span class="line"><span class="tag">      <span class="attr">bindchange</span>=<span class="string">"swiperChange"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">bindanimationfinish</span>=<span class="string">"swiperAnimateFinish"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">bindtouchstart</span>=<span class="string">"swipeTouchStart"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">bindtouchend</span>=<span class="string">"swipeTouchEnd"</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;calendarArr&#125;&#125;"</span> <span class="attr">wx:for-item</span>=<span class="string">"calendar"</span> <span class="attr">wx:key</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">swiper-item</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"calendar-container"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"item &#123;&#123;item.today?'today':''&#125;&#125; &#123;&#123;item.otherMonth?'other-month':''&#125;&#125;"</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;calendar&#125;&#125;"</span> <span class="attr">wx:key</span>=<span class="string">"dataStr"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123;item.day&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">swiper</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p>样式的话，因为<code>swiper</code>组件有默认样式，高度是<code>150px</code>，而我们这里<code>6 * 80rpx</code>，所以我们需要修改下它的默认样式，即添加下面的 css 即可:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">css</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.calendar-swiper</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">480</span>rpx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>之后就是书写我们的逻辑啦，从布局可以看到我们用了<code>touchstart</code>和<code>touchend</code>，本意其实就是判断我们是向左滑还是向右滑（向上划还是向下滑），来切换我们的月份</p><h2 id="如何区分左滑右滑（上滑下滑）"><a href="#如何区分左滑右滑（上滑下滑）" class="headerlink" title="如何区分左滑右滑（上滑下滑）"></a>如何区分左滑右滑（上滑下滑）</h2><ol><li><p>需要定两个变量供我们区分是滑动的方向，一个是<code>swipeStartPoint</code>,一个是<code>isPrevMonth</code></p></li><li><p>既然我们说到了无缝，那么肯定用户就会滑动多次，那么我们也需要一个值来计算用户滑动的次数，我们定义为<code>changeCount</code></p></li><li><p>这点也是最重要的一点，我们需用通过当前我们滑动到第几个<code>swiper-item</code>，来修改我们的上个月和下个月的数据，因为我们知道，当前的<code>swiper-item</code>肯定是中间的那个月份，所以我们也需要一个变量来标记我们当前的是第几个，我们定义为<code>currentSwiperIndex</code>，针对于这里的逻辑，我们举个例子：</p></li></ol><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">Javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 假设我们现在是6月，那么数据就是</span></span><br><span class="line"><span class="keyword">let</span> calendar = [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>];</span><br><span class="line"><span class="comment">// 那么我们的 currentSwiperIndex 这时是等于1的</span></span><br><span class="line"><span class="comment">// 假设我滑动了五月，currentSwiperIndex 这时变成0了,我们的月份还是不变</span></span><br><span class="line"><span class="comment">// 但是我们的逻辑就发生改变了</span></span><br><span class="line"><span class="comment">// 这时候的上个月变成了7，下个月变成6，我们需要通过 currentSwiperIndex 的值来动态修改他，即</span></span><br><span class="line">calendar = [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>];</span><br><span class="line"><span class="comment">// 半伪代码</span></span><br><span class="line"><span class="keyword">const</span> calendarArr = [];</span><br><span class="line"><span class="keyword">const</span> now = getDate(currentDate);</span><br><span class="line"><span class="keyword">const</span> prev = getDate(<span class="keyword">this</span>.getPrevMonth(dataStr));</span><br><span class="line"><span class="keyword">const</span> next = getDate(<span class="keyword">this</span>.getNextMonth(dataStr));</span><br><span class="line"><span class="keyword">const</span> prevIndex = currentSwiperIndex === <span class="number">0</span> ? <span class="number">2</span> : currentSwiperIndex - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> nextIndex = currentSwiperIndex === <span class="number">2</span> ? <span class="number">0</span> : currentSwiperIndex + <span class="number">1</span>;</span><br><span class="line">calendarArr[prevIndex] = prev;</span><br><span class="line">calendarArr[nextIndex] = next;</span><br><span class="line">calendarArr[currentSwiperIndex] = now;</span><br></pre></td></tr></table></figure></div><p>理清楚上面所有的，基本上我们就可以开始重构我们的代码了</p><h2 id="正式书写我们可滑动的日历组件"><a href="#正式书写我们可滑动的日历组件" class="headerlink" title="正式书写我们可滑动的日历组件"></a>正式书写我们可滑动的日历组件</h2><p>先定义我们之前的所说的变量，和处理这些变量的方法</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">Javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 当前的索引值，必须从第一个开始，因为这样我们才能实现视野内的无缝</span></span><br><span class="line"><span class="keyword">let</span> currentSwiperIndex = <span class="number">1</span>,</span><br><span class="line">  generateDate = dataStr, <span class="comment">// 当前时间</span></span><br><span class="line">  swipeStartPoint = <span class="number">0</span>, <span class="comment">// 滑动的坐标</span></span><br><span class="line">  isPrevMonth = <span class="literal">false</span>, <span class="comment">// 是否向右滑动</span></span><br><span class="line">  changeCount = <span class="number">0</span>; <span class="comment">// 滑动的次数</span></span><br><span class="line"></span><br><span class="line">Component(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">// 设置当前的索引值</span></span><br><span class="line">    swiperChange(e) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; current, source &#125; = e.detail;</span><br><span class="line">      <span class="keyword">if</span> (source === <span class="string">"touch"</span>) &#123;</span><br><span class="line">        currentSwiperIndex = current;</span><br><span class="line">        changeCount += <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 获取手指刚按下的坐标</span></span><br><span class="line">    swipeTouchStart(e) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; clientY, clientX &#125; = e.changedTouches[<span class="number">0</span>];</span><br><span class="line">      swipeStartPoint = <span class="keyword">this</span>.data.isVertical ? clientY : clientX;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 获取手指松开时的坐标</span></span><br><span class="line">    swipeTouchEnd(e) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; clientY, clientX &#125; = e.changedTouches[<span class="number">0</span>];</span><br><span class="line">      isPrevMonth = <span class="keyword">this</span>.data.isVertical</span><br><span class="line">        ? clientY - swipeStartPoint &gt; <span class="number">0</span></span><br><span class="line">        : clientX - swipeStartPoint &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div><p>然后定义一个处理我们日历数据的方法，因为我们日历方法是每个时间都需要使用的，所以我们定义个公用的方法，</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">Javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Component(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">// 设置上个月的时间</span></span><br><span class="line">    getPrevMonth(monthFormat) &#123;</span><br><span class="line">      <span class="keyword">const</span> [year, month] = monthFormat.split(<span class="regexp">/\-|\//</span>);</span><br><span class="line">      <span class="keyword">const</span> &#123; dataStr &#125; = getDateObj(</span><br><span class="line">        <span class="keyword">new</span> <span class="built_in">Date</span>(year, month, <span class="number">1</span>).setMonth(month - <span class="number">2</span>)</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">return</span> dataStr;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 设置下个月的时间</span></span><br><span class="line">    getNextMonth(monthFormat) &#123;</span><br><span class="line">      <span class="keyword">const</span> [year, month] = monthFormat.split(<span class="regexp">/\-|\//</span>);</span><br><span class="line">      <span class="keyword">const</span> &#123; dataStr &#125; = getDateObj(<span class="keyword">new</span> <span class="built_in">Date</span>(year, month, <span class="number">1</span>));</span><br><span class="line">      <span class="keyword">return</span> dataStr;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 生成日历数组</span></span><br><span class="line">    generatorCalendar(date) &#123;</span><br><span class="line">      <span class="keyword">const</span> calendarArr = [];</span><br><span class="line">      <span class="comment">// 转换为 Date 实例</span></span><br><span class="line">      <span class="keyword">const</span> currentDate = transformDate(date);</span><br><span class="line">      <span class="comment">// 获取当前时间的日历数据</span></span><br><span class="line">      <span class="keyword">const</span> now = getDate(currentDate);</span><br><span class="line">      <span class="comment">// 获取当前时间的字符串</span></span><br><span class="line">      <span class="keyword">const</span> &#123; dataStr &#125; = getDateObj(currentDate);</span><br><span class="line">      <span class="comment">// 获取上个月的日历数据</span></span><br><span class="line">      <span class="keyword">const</span> prev = getDate(<span class="keyword">this</span>.getPrevMonth(dataStr));</span><br><span class="line">      <span class="comment">// 获取下个月的日历数据</span></span><br><span class="line">      <span class="keyword">const</span> next = getDate(<span class="keyword">this</span>.getNextMonth(dataStr));</span><br><span class="line">      <span class="comment">// 设置日历数据</span></span><br><span class="line">      <span class="keyword">const</span> prevIndex = currentSwiperIndex === <span class="number">0</span> ? <span class="number">2</span> : currentSwiperIndex - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">const</span> nextIndex = currentSwiperIndex === <span class="number">2</span> ? <span class="number">0</span> : currentSwiperIndex + <span class="number">1</span>;</span><br><span class="line">      calendarArr[prevIndex] = prev;</span><br><span class="line">      calendarArr[nextIndex] = next;</span><br><span class="line">      calendarArr[currentSwiperIndex] = now;</span><br><span class="line">      <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">        calendarArr,</span><br><span class="line">        monthFormat: getDateStr(dataStr),</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div><blockquote><p>ps: 因为这里上下月份也可以公用，所以单独提取出来供其他方法使用</p></blockquote><p>最后，我们只需要在动画结束的时候设置日历数据即可，即：</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">Javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Component(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">// 动画结束后让滑动的次数置0</span></span><br><span class="line">    swiperAnimateFinish() &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; year, month &#125; = getDateObj(generateDate);</span><br><span class="line">      <span class="keyword">const</span> monthDist = isPrevMonth ? -changeCount : changeCount;</span><br><span class="line">      generateDate = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month + monthDist - <span class="number">1</span>);</span><br><span class="line">      <span class="comment">// 清空滑动次数</span></span><br><span class="line">      changeCount = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">this</span>.generatorCalendar(generateDate);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div><p>整合起来就是：</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">Javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// components/calendar/index.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; getDate, dataStr, getDateObj, transformDate &#125; = <span class="built_in">require</span>(<span class="string">"./utils"</span>);</span><br><span class="line"><span class="keyword">const</span> getDateStr = <span class="function">(<span class="params">dataStr</span>) =&gt;</span> dataStr.slice(<span class="number">0</span>, <span class="number">7</span>).replace(<span class="string">"/"</span>, <span class="string">"-"</span>);</span><br><span class="line"><span class="comment">// 当前的索引值，必须从第一个开始，因为这样我们才能实现视野内的无缝</span></span><br><span class="line"><span class="keyword">let</span> currentSwiperIndex = <span class="number">1</span>,</span><br><span class="line">  generateDate = dataStr, <span class="comment">// 当前时间</span></span><br><span class="line">  swipeStartPoint = <span class="number">0</span>, <span class="comment">// 滑动的坐标</span></span><br><span class="line">  isPrevMonth = <span class="literal">false</span>, <span class="comment">// 是否向右滑动</span></span><br><span class="line">  changeCount = <span class="number">0</span>; <span class="comment">// 滑动的次数</span></span><br><span class="line">Component(&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 组件的属性列表</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  properties: &#123;</span><br><span class="line">    duration: &#123;</span><br><span class="line">      type: <span class="built_in">String</span>,</span><br><span class="line">      value: <span class="number">500</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    isVertical: &#123;</span><br><span class="line">      type: <span class="built_in">Boolean</span>,</span><br><span class="line">      value: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 组件的初始数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  data: &#123;</span><br><span class="line">    week: [<span class="string">"一"</span>, <span class="string">"二"</span>, <span class="string">"三"</span>, <span class="string">"四"</span>, <span class="string">"五"</span>, <span class="string">"六"</span>, <span class="string">"日"</span>],</span><br><span class="line">    current: <span class="number">1</span>,</span><br><span class="line">    calendarArr: [],</span><br><span class="line">    monthFormat: getDateStr(dataStr),</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 组件的方法列表</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">// 设置上个月的时间</span></span><br><span class="line">    getPrevMonth(monthFormat) &#123;</span><br><span class="line">      <span class="keyword">const</span> [year, month] = monthFormat.split(<span class="regexp">/\-|\//</span>);</span><br><span class="line">      <span class="keyword">const</span> &#123; dataStr &#125; = getDateObj(</span><br><span class="line">        <span class="keyword">new</span> <span class="built_in">Date</span>(year, month, <span class="number">1</span>).setMonth(month - <span class="number">2</span>)</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">return</span> dataStr;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 设置下个月的时间</span></span><br><span class="line">    getNextMonth(monthFormat) &#123;</span><br><span class="line">      <span class="keyword">const</span> [year, month] = monthFormat.split(<span class="regexp">/\-|\//</span>);</span><br><span class="line">      <span class="keyword">const</span> &#123; dataStr &#125; = getDateObj(<span class="keyword">new</span> <span class="built_in">Date</span>(year, month, <span class="number">1</span>));</span><br><span class="line">      <span class="keyword">return</span> dataStr;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 生成日历数组</span></span><br><span class="line">    generatorCalendar(date) &#123;</span><br><span class="line">      <span class="keyword">const</span> calendarArr = [];</span><br><span class="line">      <span class="comment">// 转换为 Date 实例</span></span><br><span class="line">      <span class="keyword">const</span> currentDate = transformDate(date);</span><br><span class="line">      <span class="comment">// 获取当前时间的日历数据</span></span><br><span class="line">      <span class="keyword">const</span> now = getDate(currentDate);</span><br><span class="line">      <span class="comment">// 获取当前时间的字符串</span></span><br><span class="line">      <span class="keyword">const</span> &#123; dataStr &#125; = getDateObj(currentDate);</span><br><span class="line">      <span class="comment">// 获取上个月的日历数据</span></span><br><span class="line">      <span class="keyword">const</span> prev = getDate(<span class="keyword">this</span>.getPrevMonth(dataStr));</span><br><span class="line">      <span class="comment">// 获取下个月的日历数据</span></span><br><span class="line">      <span class="keyword">const</span> next = getDate(<span class="keyword">this</span>.getNextMonth(dataStr));</span><br><span class="line">      <span class="comment">// 设置日历数据</span></span><br><span class="line">      <span class="keyword">const</span> prevIndex = currentSwiperIndex === <span class="number">0</span> ? <span class="number">2</span> : currentSwiperIndex - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">const</span> nextIndex = currentSwiperIndex === <span class="number">2</span> ? <span class="number">0</span> : currentSwiperIndex + <span class="number">1</span>;</span><br><span class="line">      calendarArr[prevIndex] = prev;</span><br><span class="line">      calendarArr[nextIndex] = next;</span><br><span class="line">      calendarArr[currentSwiperIndex] = now;</span><br><span class="line">      <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">        calendarArr,</span><br><span class="line">        monthFormat: getDateStr(dataStr),</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// 通知父组件</span></span><br><span class="line">      <span class="keyword">this</span>.triggerEvent(<span class="string">"change"</span>, <span class="keyword">this</span>.data.monthFormat);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 设置当前的索引值</span></span><br><span class="line">    swiperChange(e) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; current, source &#125; = e.detail;</span><br><span class="line">      <span class="keyword">if</span> (source === <span class="string">"touch"</span>) &#123;</span><br><span class="line">        currentSwiperIndex = current;</span><br><span class="line">        changeCount += <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 动画结束后让滑动的次数置0</span></span><br><span class="line">    swiperAnimateFinish() &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; year, month &#125; = getDateObj(generateDate);</span><br><span class="line">      <span class="keyword">const</span> monthDist = isPrevMonth ? -changeCount : changeCount;</span><br><span class="line">      generateDate = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month + monthDist - <span class="number">1</span>);</span><br><span class="line">      <span class="comment">// 清空滑动次数</span></span><br><span class="line">      changeCount = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">this</span>.generatorCalendar(generateDate);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 获取手指刚按下的坐标</span></span><br><span class="line">    swipeTouchStart(e) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; clientY, clientX &#125; = e.changedTouches[<span class="number">0</span>];</span><br><span class="line">      swipeStartPoint = <span class="keyword">this</span>.data.isVertical ? clientY : clientX;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 获取手指松开时的坐标</span></span><br><span class="line">    swipeTouchEnd(e) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; clientY, clientX &#125; = e.changedTouches[<span class="number">0</span>];</span><br><span class="line">      isPrevMonth = <span class="keyword">this</span>.data.isVertical</span><br><span class="line">        ? clientY - swipeStartPoint &gt; <span class="number">0</span></span><br><span class="line">        : clientX - swipeStartPoint &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    dateChange(e) &#123;</span><br><span class="line">      <span class="keyword">const</span> monthFormat = e.detail.value;</span><br><span class="line">      <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">        monthFormat,</span><br><span class="line">      &#125;);</span><br><span class="line">      generateDate = getDateStr(monthFormat);</span><br><span class="line">      <span class="keyword">this</span>.generatorCalendar(generateDate);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 上个月日期</span></span><br><span class="line">    prevMonth() &#123;</span><br><span class="line">      <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">        monthFormat: <span class="keyword">this</span>.getPrevMonth(<span class="keyword">this</span>.data.monthFormat),</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">this</span>.generatorCalendar(<span class="keyword">this</span>.data.monthFormat);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 下个月日期</span></span><br><span class="line">    nextMonth() &#123;</span><br><span class="line">      <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">        monthFormat: <span class="keyword">this</span>.getNextMonth(<span class="keyword">this</span>.data.monthFormat),</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">this</span>.generatorCalendar(<span class="keyword">this</span>.data.monthFormat);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  ready() &#123;</span><br><span class="line">    <span class="keyword">this</span>.generatorCalendar(generateDate);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div><p>页面中使用，</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">calendar</span> <span class="attr">bindchange</span>=<span class="string">"calendarChange"</span>&gt;</span><span class="tag">&lt;/<span class="name">calendar</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">Javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  calendarChange(e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e.detail);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div><p>写到这里，其实基本上整个日历就已经完成了，但也许你会说，其实还有很多功能没有完善，比如:</p><ul><li><p>跳转到指定到时间</p></li><li><p>范围选择</p></li><li><p>点击标记时间等等</p></li><li><p>…</p></li></ul><p>其实我觉得多数是设置样式问题，比如标记时间这个功能，其实有这个基础的例子，我想大家往里面加功能应该都可以实现的，所以我就不一步一步的往里面写了</p><p>如果后续有时间我会往这个项目多加一下新功能的</p><blockquote><p><a href="https://gitee.com/gating/demo/tree/master/calendar" target="_blank" rel="noopener">gitee 地址</a>,<a href="https://github.com/GATING/demo/tree/master/calendar" target="_blank" rel="noopener">github 地址</a></p></blockquote><h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>感觉各位观众老爷的观看，希望你能有所收获 😁</p></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">gating</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://gatings.cn/2020-06-08/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E5%86%99%E4%B8%80%E4%B8%AA%E7%AC%A6%E5%90%88%E8%87%AA%E5%B7%B1%E9%9C%80%E6%B1%82%E7%9A%84%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%97%A5%E5%8E%86%E7%BB%84%E4%BB%B6/">https://gatings.cn/2020-06-08/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E5%86%99%E4%B8%80%E4%B8%AA%E7%AC%A6%E5%90%88%E8%87%AA%E5%B7%B1%E9%9C%80%E6%B1%82%E7%9A%84%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%97%A5%E5%8E%86%E7%BB%84%E4%BB%B6/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://gatings.cn">磨蹭先生</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/">小程序</a></div><div class="post_share"></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://cdn.jsdelivr.net/gh/GATING/blog_imgs@master/blog/wechat.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://cdn.jsdelivr.net/gh/GATING/blog_imgs@master/blog/alipay.jpg" alt="支付宝"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020-06-10/node%E5%9B%BE%E7%89%87%E5%9B%9B%E5%91%A8%E5%A1%AB%E5%85%85%E9%80%8F%E6%98%8E%E5%8C%BA%E5%9F%9F/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror='onerror=null,src="/img/404.jpg"'><div class="label">上一篇</div><div class="prev_info"><span>node实现图片四周填充透明区域</span></div></a></div><div class="next-post pull_right"><a href="/2020-06-04/Charles%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror='onerror=null,src="/img/404.jpg"'><div class="label">下一篇</div><div class="next_info"><span>Charles（青花瓷/花瓶）的基本使用</span></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="lv-container" data-id="city" data-uid="MTAyMC8zNTA5MC8xMTYyNQ=="><script>!function(e,t){var n,c=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&((n=e.createElement(t)).src="https://cdn-city.livere.com/js/embed.dist.js",n.async=!0,c.parentNode.insertBefore(n,c))}(document,"script")</script></div></div></div></main><footer id="footer" style="background-image:url(https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2017 - 2020 By gating</div><div class="footer_custom_text">由<b>&nbsp;磨蹭&nbsp;</b>倾力打造&nbsp;|&nbsp;<b>女王大人</b>&nbsp;-&nbsp;热情赞助</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments"></i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/click_heart.js"></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49b1f5">hexo-generator-search</a> <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>