---
layout: post
title: JSä¸­æœ‰è¶£çš„å†…ç½®å¯¹è±¡-JSON
tags: javascript
category: è®°å½•
description: åœ¨ä»¥å‰çš„webå¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¤šæ•°é€‰æ‹©çº¯æ–‡æœ¬æˆ–XMLä½œä¸ºæˆ‘ä»¬çš„æäº¤çš„æ•°æ®æ ¼å¼ï¼Œå¤§å¤šæ•°æ˜¯XMLï¼Œå°‘æ•°çº¯æ–‡æœ¬ã€‚å…¶å®ä»AJAX(Asynchronous JavaScript and XML)çš„å‘½åæˆ‘ä»¬ä¹ŸçŸ¥é“ï¼Œæ•°æ®äº¤æ¢æ˜¯å¤§å¤šæ•°é€šè¿‡XMLæ ¼å¼è¿›è¡Œçš„ã€‚
date: 2020/09/08
---

# å‰è¨€

åœ¨ä»¥å‰çš„`webå¼€å‘ä¸­`ï¼Œæˆ‘ä»¬å¤šæ•°é€‰æ‹©`çº¯æ–‡æœ¬`æˆ–`XML`ä½œä¸ºæˆ‘ä»¬çš„æäº¤çš„æ•°æ®æ ¼å¼ï¼Œå¤§å¤šæ•°æ˜¯`XML`ï¼Œå°‘æ•°`çº¯æ–‡æœ¬`ã€‚å…¶å®ä»`AJAX(Asynchronous JavaScript and XML)`çš„å‘½åæˆ‘ä»¬ä¹ŸçŸ¥é“ï¼Œæ•°æ®äº¤æ¢æ˜¯å¤§å¤šæ•°é€šè¿‡`XML`æ ¼å¼è¿›è¡Œçš„ã€‚ä½†æ˜¯`XML`æ ¼å¼æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯æ–‡æ¡£æ„é€ å¤æ‚ï¼Œéœ€è¦ä¼ è¾“æ¯”è¾ƒå¤šçš„å­—èŠ‚æ•°ï¼Œå¹¶ä¸”è§£æèµ·æ¥ä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚æ‰€ä»¥å°±åˆ›å»ºäº†`JSON`è¿™ç§æ•°æ®æè¿°æ ¼å¼ï¼Œå¯ä»¥å¾ˆç®€å•çš„å°±æè¿°å¾ˆå¤æ‚çš„æ•°æ®ã€‚åŒæ—¶ç‹¬ç«‹äºè¯­è¨€ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨å¤šç§è¯­è¨€å†…ä½¿ç”¨ã€‚ä¹Ÿæ­£æ˜¯å› ä¸ºè¿™ä¸ªï¼Œ`JSON`çš„è½»ä¾¿æ€§é€æ¸å¾—åˆ°é‡è§†ï¼Œåæ¥æ›¿ä»£`XML`æˆä¸ºæœ€ä¸»è¦çš„æ•°æ®ä¼ è¾“æ ¼å¼ã€‚

> ps: å½“ç„¶ï¼Œè™½ç„¶è¯´äº†å¾ˆå¤š`JSON`çš„å¥½å¤„ï¼Œä½ å°±ä»¥ä¸ºä¸ç”¨å­¦ä¹ `XML`äº†å—ï¼Ÿè‚¯å®šä¸æ˜¯å•¦ï¼Œå¾®ä¿¡å…¬å…±å¹³å°æ¥å£ä¸­çš„æœ‰æ˜¯æœ‰ç›¸å½“ä¸€éƒ¨åˆ†æ¥å£ä½¿ç”¨äº†`XML`çš„ã€‚

`JSON`å¯¹è±¡åŒ…å«ä¸¤ä¸ªæ–¹æ³•: ç”¨äºè§£æ [JavaScript Object Notation](https://www.json.org/json-en.html) ([JSON](https://developer.mozilla.org/zh-CN/docs/Glossary/JSON)) çš„ parse() æ–¹æ³•ï¼Œä»¥åŠå°†å¯¹è±¡/å€¼è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²çš„ stringify() æ–¹æ³•ã€‚é™¤äº†è¿™ä¸¤ä¸ªæ–¹æ³•, JSON è¿™ä¸ªå¯¹è±¡æœ¬èº«å¹¶æ²¡æœ‰å…¶ä»–ä½œç”¨ï¼Œä¹Ÿä¸èƒ½è¢«è°ƒç”¨æˆ–è€…ä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨ã€‚

> ps: [JSONï¼šå¹¶ä¸æ˜¯ JavaScript çš„å­é›†ã€‚](http://timelessrepo.com/json-isnt-a-javascript-subset)å°½ç®¡ä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„å­é›†ï¼ŒJSON éå¸¸æ¥è¿‘ JavaScript è¯­æ³•çš„å­é›†ã€‚

# JavaScript ä¸ JSON çš„åŒºåˆ«

| JavaScriptç±»å‹ | JSON çš„ä¸åŒç‚¹                                                                                                                           |
| -------------- | --------------------------------------------------------------------------------------------------------------------------------------- |
| å¯¹è±¡å’Œæ•°ç»„     | å±æ€§åç§°å¿…é¡»æ˜¯åŒå¼•å·æ‹¬èµ·æ¥çš„å­—ç¬¦ä¸²ï¼›æœ€åä¸€ä¸ªå±æ€§åä¸èƒ½æœ‰é€—å·ã€‚                                                                          |
| æ•°å€¼           | ç¦æ­¢å‡ºç°å‰å¯¼é›¶ï¼ˆJSON.stringify æ–¹æ³•è‡ªåŠ¨å¿½ç•¥å‰å¯¼é›¶ï¼Œè€Œåœ¨ JSON.parse æ–¹æ³•ä¸­å°†ä¼šæŠ›å‡º SyntaxErrorï¼‰ï¼›å¦‚æœæœ‰å°æ•°ç‚¹, åˆ™åé¢è‡³å°‘è·Ÿç€ä¸€ä½æ•°å­—ã€‚ |


é’ˆå¯¹äºè¿™ä¸¤ç‚¹ï¼Œæˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼Œå¯¹äºå¯¹è±¡å’Œæ•°ç»„ç±»å‹ï¼š

```js
// å±æ€§åç§°å¿…é¡»æ˜¯åŒå¼•å·æ‹¬èµ·æ¥çš„å­—ç¬¦ä¸²
const test1 = "['1','1']"
JSON.parse(test1) // Uncaught SyntaxError: Unexpected token ' in JSON at position 1

const test2 = "{'name':'gating'}"
JSON.parse(test2) // Uncaught SyntaxError: Unexpected token o in JSON at position 1

const test3 = '["2","1"]'
JSON.parse(test3) // ["2","1"]

const test4 = '{"name":"gating"}'
JSON.parse(test3) // {name: "gating"}

// æœ€åä¸€ä¸ªå±æ€§åä¸èƒ½æœ‰é€—å·
const test5 = '["2","1",]'
JSON.parse(test5) // Uncaught SyntaxError: Unexpected token ] in JSON at position 9
const test6 = '{"name":"gating",}'
JSON.parse(test6) // Uncaught SyntaxError: Unexpected token } in JSON at position 17
```

å¯¹äºæ•°å€¼ç±»å‹ï¼š
```js
// ç¦æ­¢å‡ºç°å‰å¯¼é›¶
const test7 = [00010, 1]
JSON.stringify(test7) // "[8,1]"

const test8 = "[00010, 1]"
JSON.parse(test8) // SyntaxError: Unexpected number in JSON at position 2**

// å¦‚æœæœ‰å°æ•°ç‚¹ï¼Œåˆ™åé¢è‡³å°‘è·Ÿç€ä¸€ä½æ•°å­—ã€‚
const test9 = [1, 1.]
JSON.stringify(test9) // "[1,1]"

const test10 = "[1, 1.]"
JSON.parse(test10) // Uncaught SyntaxError: Unexpected token ] in JSON at position 6
```

> ps: **0+æ•°å­—**è¡¨ç¤º8è¿›åˆ¶ï¼Œ- -æ‰€ä»¥ä¸Šé¢æ‰“å°å‡ºæ¥çš„æ˜¯8ï¼ŒåŒæ ·çš„æœ‰ï¼š**0b+æ•°å­—(äºŒè¿›åˆ¶)**ã€**0x+æ•°å­—(16è¿›åˆ¶)**ï¼Œå…¶å®**0o+æ•°å­—**ä¹Ÿå¯ä»¥è¡¨ç¤º8è¿›åˆ¶


å…¶å®è¿˜æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼Œ**JavaScript**å’Œ**JSON**å¤„ç†æ˜¯ä¸ä¸€è‡´çš„ï¼Œè¿™é‡Œä¸ºå•¥æˆ‘åªå†™ä¸¤ç‚¹å‘¢ï¼Ÿæ˜¯å› ä¸ºè¿˜æœ‰ç°åœ¨åœ¨æ–°ç‰ˆçš„**Chrome**å·²ç»å¯ä»¥è§£ææ­£å¸¸ï¼Œä½†æ˜¯æƒ³å…·ä½“å¯ä»¥æŸ¥çœ‹ä¸‹é¢[å‚è€ƒé“¾æ¥](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON)è‡ªè¡Œäº†è§£ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†

> å‚è€ƒï¼š[JavaScript ä¸ JSON çš„åŒºåˆ«](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON)ï¼Œå­—ç¬¦ä¸²é‚£ä¸€ç‚¹æˆ‘åœ¨**Chrome 85.0.4183.83**ä»¥åŠå¯ä»¥æ­£å¸¸è§£æ

# stringify

stringify() æ–¹æ³•ç”¨äºå°†`JavaScript`å€¼è½¬æ¢ä¸º`JSON`å­—ç¬¦ä¸²ã€‚

è™½ç„¶æˆ‘ä»¬ç»å¸¸ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œä½†æˆ‘æƒ³ä¼°è®¡æœ‰ä¸å°‘äººä¸çŸ¥é“å®ƒå±…ç„¶æœ‰ä¸‰ä¸ªå‚æ•°ä¹‹å¤šå§ï¼Ÿåˆ†åˆ«æ˜¯`value`ã€`replacer`ã€`space`ã€‚

> JSON.stringify(value[, replacer [, space]])

- value
  - å°†è¦åºåˆ—åŒ–æˆ ä¸€ä¸ª JSON å­—ç¬¦ä¸²çš„å€¼ã€‚
- replacer `å¯é€‰`
  - å¦‚æœè¯¥å‚æ•°æ˜¯ä¸€ä¸ª**å‡½æ•°**ï¼Œåˆ™åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œè¢«åºåˆ—åŒ–çš„å€¼çš„æ¯ä¸ªå±æ€§éƒ½ä¼šç»è¿‡è¯¥å‡½æ•°çš„è½¬æ¢å’Œå¤„ç†ï¼›å¦‚æœè¯¥å‚æ•°æ˜¯ä¸€ä¸ª**æ•°ç»„**ï¼Œåˆ™åªæœ‰åŒ…å«åœ¨è¿™ä¸ªæ•°ç»„ä¸­çš„å±æ€§åæ‰ä¼šè¢«åºåˆ—åŒ–åˆ°æœ€ç»ˆçš„ JSON å­—ç¬¦ä¸²ä¸­ï¼›å¦‚æœè¯¥å‚æ•°ä¸º **null** æˆ–è€…æœªæä¾›ï¼Œåˆ™å¯¹è±¡æ‰€æœ‰çš„å±æ€§éƒ½ä¼šè¢«åºåˆ—åŒ–ã€‚
- space `å¯é€‰`
  - æŒ‡å®šç¼©è¿›ç”¨çš„ç©ºç™½å­—ç¬¦ä¸²ï¼Œç”¨äºç¾åŒ–è¾“å‡ºï¼ˆpretty-printï¼‰ï¼›å¦‚æœå‚æ•°æ˜¯ä¸ªæ•°å­—ï¼Œå®ƒä»£è¡¨æœ‰å¤šå°‘çš„ç©ºæ ¼ï¼›ä¸Šé™ä¸º10ã€‚è¯¥å€¼è‹¥å°äº1ï¼Œåˆ™æ„å‘³ç€æ²¡æœ‰ç©ºæ ¼ï¼›å¦‚æœè¯¥å‚æ•°ä¸ºå­—ç¬¦ä¸²ï¼ˆå½“å­—ç¬¦ä¸²é•¿åº¦è¶…è¿‡10ä¸ªå­—æ¯ï¼Œå–å…¶å‰10ä¸ªå­—æ¯ï¼‰ï¼Œè¯¥å­—ç¬¦ä¸²å°†è¢«ä½œä¸ºç©ºæ ¼ï¼›å¦‚æœè¯¥å‚æ•°æ²¡æœ‰æä¾›ï¼ˆæˆ–è€…ä¸º nullï¼‰ï¼Œå°†æ²¡æœ‰ç©ºæ ¼ã€‚


## valueå‚æ•°

é€šå¸¸æˆ‘ä»¬æœ€å¸¸ç”¨çš„å°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯valueå‚æ•°ï¼Œä½†æ˜¯ä½ çŸ¥é“å®ƒçš„è¿ç®—è§„åˆ™æ˜¯æ€ä¹ˆæ ·çš„å—ï¼Ÿé—²è¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä¾‹å­

### NaN å’Œ Infinity æ ¼å¼çš„æ•°å€¼åŠ null éƒ½ä¼šè¢«å½“åš null

```js
JSON.stringify([NaN, Infinity, null]) // [null,null,null]
```

### undefinedã€ä»»æ„çš„å‡½æ•°ä»¥åŠ symbol å€¼çš„å¤„ç†

#### å‡ºç°åœ¨éæ•°ç»„å¯¹è±¡çš„å±æ€§å€¼ä¸­æ—¶ï¼Œåœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¼šè¢«å¿½ç•¥

```js
JSON.stringify({x: undefined, y: Object, z: Symbol("")}) // "{}"
```

#### å‡ºç°åœ¨æ•°ç»„ä¸­æ—¶è¢«è½¬æ¢æˆnull

```js
JSON.stringify([undefined, Object, Symbol("")])  // "[null,null,null]"
```

#### å•ç‹¬å‡ºç°åˆ™ä¼šè¿”å›undefined

```js
JSON.stringify(undefined)  // undefined
JSON.stringify(Object)  // undefined
JSON.stringify(Symbol(""))  // undefined
```

### æ‰€æœ‰ä»¥ symbol ä¸ºå±æ€§é”®çš„å±æ€§éƒ½ä¼šè¢«å®Œå…¨å¿½ç•¥æ‰ï¼Œå³ä¾¿ replacer å‚æ•°ä¸­å¼ºåˆ¶æŒ‡å®šåŒ…å«äº†å®ƒä»¬ã€‚

```js
JSON.stringify({[Symbol("foo")]: "foo"}) // "{}"
JSON.stringify({[Symbol.for("foo")]: "foo"}, [Symbol.for("foo")]) // "{}"
```


### è½¬æ¢å€¼å¦‚æœæœ‰ toJSON() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å®šä¹‰ä»€ä¹ˆå€¼å°†è¢«åºåˆ—åŒ–ã€‚

```js
JSON.stringify({
  toJSON: function() {
    return 'gating'
  }
}) // "gating"

const name = {
  age: 18,
  toJSON: function () {
    return 'gating'
  },
}
JSON.stringify({ name }) // {"name":"gating"}
```


åˆå› ä¸º**Date**å¯¹è±¡ä¸ŠæŒ‚è½½äº†ä¸€ä¸ª**toJSON**æ–¹æ³•ï¼Œæ‰€ä»¥é’ˆå¯¹äº**Date**ç±»å‹ï¼Œå®ƒé»˜è®¤å°±ä¼šè°ƒç”¨**Date**ç±»å‹ä¸Šçš„**toJSON**æ–¹æ³•(åŒDate.toISOString())

```js
JSON.stringify(new Date("2020/01/01")) // "2019-12-31T16:00:00.000Z" å› ä¸ºä¸­å›½åœ¨ä¸œå…«åŒºï¼Œæ‰€ä»¥ç›¸å·®äº†8å°æ—¶
```

> ps: ä¸œå…«åŒºï¼ˆUTC/GMT+08:00ï¼‰æ˜¯æ¯”ä¸–ç•Œåè°ƒæ—¶é—´ï¼ˆUTCï¼‰/æ ¼æ—å°¼æ²»æ—¶é—´ï¼ˆGMTï¼‰å¿«8å°æ—¶çš„æ—¶åŒº


### å…¶ä»–ç±»å‹çš„å¯¹è±¡ï¼Œä»…ä¼šåºåˆ—åŒ–å¯¹è±¡å¯æšä¸¾çš„å±æ€§ï¼ŒåŒ…æ‹¬ Map/Set/WeakMap/WeakSet

```js
JSON.stringify(
  Object.create(null, {
    x: { value: 'x'}, // enumerable é»˜è®¤ä¸ºä¸å¯æšä¸¾
    y: { value: 'y', enumerable: true },
  })
) // "{"y":"y"}"

const map = new Map()
Object.defineProperty(map, 'name', {
  value: 'gating',
  enumerable: true
})
Object.defineProperty(map, 'age', {
  value: 18
})
JSON.stringify(map) // {"name":"gating"}
JSON.stringify(new Set) // {}
JSON.stringify(new RegExp) // {}
```

çœ‹åˆ°è¿™é‡Œï¼Œä½ åŸºæœ¬å·²ç»çŸ¥é“è¿ç®—è§„åˆ™æ˜¯æ€ä¹ˆæ ·æ»´äº†ï¼Œä¹Ÿå°±çŸ¥é“äº†ä¸ºä»€ä¹ˆ`JSON.stringify + JSON.parse`ä¸èƒ½è½¬æ¢å‡½æ•°ã€æ­£åˆ™ã€Errorç­‰å¯¹è±¡äº†å§ï¼Ÿ

é‚£ä¹ˆæ¥ä¸‹æ¥å°±è¦äº†è§£ä¸‹æ›´æœ‰æ„æ€çš„ä¸œè¥¿å•¦ï¼Œå°±æ˜¯`stringify`ç¬¬äºŒä¸ªå‚æ•°`replacer`å•¦

## replacerå‚æ•°

replacer å‚æ•°å¯ä»¥ç”¨æ¥æ¥æ›´æ”¹é»˜è®¤çš„å­—ç¬¦ä¸²åŒ–çš„è¡Œä¸ºã€‚å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–è€…ä¸€ä¸ªæ•°ç»„ã€‚å¦‚æœè¯¥å‚æ•°ä¸º null æˆ–è€…æœªæä¾›ï¼Œåˆ™å¯¹è±¡æ‰€æœ‰çš„å±æ€§éƒ½ä¼šè¢«åºåˆ—åŒ–ã€‚

### ä½œä¸ºå‡½æ•°

åœ¨å¼€å§‹æ—¶, replacer å‡½æ•°ä¼šè¢«ä¼ å…¥ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ä½œä¸º key å€¼ï¼Œä»£è¡¨ç€è¦è¢« stringify çš„è¿™ä¸ªå¯¹è±¡ã€‚éšåæ¯ä¸ªå¯¹è±¡æˆ–æ•°ç»„ä¸Šçš„å±æ€§ä¼šè¢«ä¾æ¬¡ä¼ å…¥ã€‚

è¿™å¥è¯çœ‹ä¸å¤ªæ‡‚ï¼Ÿä¸è¦ç´§ï¼Œä¸¾ä¸ªä¾‹å­ä½ å°±æ‡‚äº†

```js
function replacer(key, value) {
  console.log('[' + key + ']:' + value)
  return value
}

JSON.stringify({ name: 'gating', age: 18 }, replacer)
// []:[object Object]
// [name]:gating
// [age]:18
```

ä¸Šé¢ä¾‹å­ä¸­ï¼Œä»–ä¼šæ‰§è¡Œä¸‰æ¬¡ï¼Œä¹Ÿå°±æ˜¯ä¸€å¼€å§‹ä»–ä¼šé»˜è®¤ä¼ ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ä½œä¸ºé”®ï¼Œè€Œé”®å€¼æ˜¯æ•´ä¸ªå¯¹è±¡ï¼›ç¬¬äºŒæ¬¡é”®ä¸º`name`ï¼Œé”®å€¼ä¸º`gating`ï¼Œä»¥æ­¤ç±»æ¨ã€‚


å½“ç„¶ï¼Œè¿™é‡Œä¹Ÿæœ‰ä¸ªç‰¹åˆ«éœ€è¦æ³¨æ„çš„ç‚¹ï¼Œå°±æ˜¯è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œè¯¥å¯¹è±¡é€’å½’åœ°åºåˆ—åŒ–æˆ JSON å­—ç¬¦ä¸²ï¼Œå¯¹æ¯ä¸ªå±æ€§è°ƒç”¨`replacer`æ–¹æ³•ã€‚é™¤éè¯¥å¯¹è±¡æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ç§æƒ…å†µå°†ä¸ä¼šè¢«åºåˆ—åŒ–æˆ JSON å­—ç¬¦ä¸²ã€‚

æ¯”å¦‚ï¼š

```js
function replacer(key, value) {
  return {a:1}
}
JSON.stringify({}, replacer)
```

å› ä¸ºæˆ‘ä»¬æ¯æ¬¡è¿”å›çš„éƒ½æ˜¯å¯¹è±¡ï¼Œé‚£ä¹ˆæ¯æ¬¡éƒ½ä¼šè°ƒç”¨`replacer`ï¼Œæ‰€ä»¥ä¼šé€ æˆå †æ ˆæº¢å‡ºï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸¾ä¸ªä¸ä¼šæº¢å‡ºçš„å°æ —å­ä¾‹å­å§ğŸ¤£ï¼š

```js
function replacer(key, value) {
  if(typeof value === 'object'){
    return { age: 9 }
  }
  return value * 2
}
const name = {}
JSON.stringify(name, replacer) // {"age":18}
```

åœ¨è¿™é‡Œï¼Œæ¯ä¸€æ¬¡å¤„ç†çš„å¯¹è±¡ï¼Œéƒ½æ˜¯å‰ä¸€æ¬¡è¿”å›çš„å€¼ã€‚å› ä¸ºæˆ‘ä»¬`replacer`ä¿®æ”¹äº†`name`å¯¹è±¡ï¼Œæ¥ç€å°±è¦é€’å½’`replacer`å¤„ç†ä¿®æ”¹åçš„å¯¹è±¡ã€‚

> æ€»ç»“ï¼šé€’å½’å¤„ç†ä¸­ï¼Œæ¯ä¸€æ¬¡å¤„ç†çš„å¯¹è±¡ï¼Œéƒ½æ˜¯å‰ä¸€æ¬¡è¿”å›çš„å€¼ã€‚

```js
function f(key, value){
  console.log(value)
  if (typeof value === "object"){
    return {b: 2};
  }
  return value*2;
}

JSON.stringify(o,f)
```


é‚£ä¹ˆï¼Œæ—¢ç„¶æ˜¯æ›´æ”¹é»˜è®¤çš„å­—ç¬¦ä¸²åŒ–çš„è¡Œä¸ºï¼Œé‚£ä¹ˆæˆ‘å°±å°è¯•ä¸‹æ›´æ”¹ä¸‹å§

#### replacerâ€”â€”æ•°å­—Double

```js
function replacer(key, value) {
  if (typeof value === "number") {
    return value * 2;
  }
  return value;
}
const me = {
  name: 'gating',
  age: 9,
}
JSON.stringify(me, replacer) // {"name":"gating","age":18}
```

#### replacerâ€”â€”å‰”é™¤ä¸è¦çš„å±æ€§

```js
function replacer(key, value) {
  if (typeof value === "string") {
    return undefined;
  }
  return value;
}
const me = {
  name: 'gating',
  age: 18,
}
JSON.stringify(me, replacer) // {"age":18} å‰”é™¤äº†nameå±æ€§
JSON.stringify([1,"2"], replacer) // "[1,null]"
```

> æ³¨æ„: ä¸èƒ½ç”¨ replacer æ–¹æ³•ï¼Œä»æ•°ç»„ä¸­ç§»é™¤å€¼ï¼ˆvaluesï¼‰ï¼Œå¦‚è‹¥è¿”å› undefined æˆ–è€…ä¸€ä¸ªå‡½æ•°ï¼Œå°†ä¼šè¢« null å–ä»£(å…¶å®ä» value çš„è¿ç®—è§„åˆ™æˆ‘ä»¬ä¹ŸçŸ¥é“ä¼šå‡ºç°è¿™ä¸ªç»“æœäº†)ã€‚

### ä½œä¸ºæ•°ç»„

æ•°ç»„çš„å€¼ä»£è¡¨å°†è¢«åºåˆ—åŒ–æˆ`JSON`å­—ç¬¦ä¸²çš„å±æ€§å

```js
const me = {
  name: 'gating',
  age: 18,
}
JSON.stringify(me, ['name']) // {"name":"gating"} åªä¿ç•™äº†nameçš„å±æ€§å€¼
JSON.stringify(['a', 'b'], ['0']) // ['a', 'b']
```
> è¿™ä¸ªç±»ä¼¼ç™½åå•çš„æ•°ç»„ï¼Œåªå¯¹å¯¹è±¡çš„å±æ€§æœ‰æ•ˆï¼Œå¯¹æ•°ç»„æ— æ•ˆã€‚

## spaceå‚æ•°

space å‚æ•°ç”¨æ¥æ§åˆ¶ç»“æœå­—ç¬¦ä¸²é‡Œé¢çš„é—´è·ï¼Œå¢åŠ è¿”å›çš„ JSON å­—ç¬¦ä¸²çš„å¯è¯»æ€§ã€‚å¦‚æœæ˜¯ä¸€ä¸ªæ•°å­—, åˆ™åœ¨å­—ç¬¦ä¸²åŒ–æ—¶æ¯ä¸€çº§åˆ«ä¼šæ¯”ä¸Šä¸€çº§åˆ«ç¼©è¿›å¤šè¿™ä¸ªæ•°å­—å€¼çš„ç©ºæ ¼ï¼ˆæœ€å¤š10ä¸ªç©ºæ ¼ï¼‰ï¼›å¦‚æœæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ™æ¯ä¸€çº§åˆ«ä¼šæ¯”ä¸Šä¸€çº§åˆ«å¤šç¼©è¿›è¯¥å­—ç¬¦ä¸²ï¼ˆæˆ–è¯¥å­—ç¬¦ä¸²çš„å‰10ä¸ªå­—ç¬¦ï¼‰ã€‚

### ä½¿ç”¨æ•°å­—

```js
JSON.stringify({ name: "gating", age: 18 }, null, 6)
/*
"{
      "name": "gating",
      "age": 18
}"
*/
```

### ä½¿ç”¨å­—ç¬¦ä¸²

```js
JSON.stringify({ name: "gating", age: 18 }, null, '|-')
/*
"{
|-"name": "gating",
|-"age": 18
}"
*/
```

### ä½¿ç”¨åˆ¶è¡¨ç¬¦ï¼ˆ\tï¼‰æ¥ç¼©è¿›

å› ä¸ºæœ€ç”¨ç”¨åˆ°è¦ç¾åŒ–JSONçš„åœºæ™¯ï¼Œæ‰€ä»¥é¡ºä¾¿æŠŠåˆ¶è¡¨ç¬¦ä¹Ÿå†™å‡ºæ¥äº† ğŸ˜Š

å°±æ˜¯æäº¤çš„æ—¶å€™æ˜¯jsonï¼Œè¿”å›çš„æ—¶å€™ç¾åŒ–jsonæ˜¾ç¤ºåˆ°è¾“å…¥æ¡†å†…

```js
JSON.stringify({ name: "gating", age: 18 }, null, '\t')
/*
"{
	"name": "gating",
	"age": 18
}"
*/
```

## æ€»ç»“

- JSON.stringify()å°†å€¼è½¬æ¢ä¸ºç›¸åº”çš„JSONæ ¼å¼ï¼š
  - è½¬æ¢å€¼å¦‚æœæœ‰ toJSON() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å®šä¹‰ä»€ä¹ˆå€¼å°†è¢«åºåˆ—åŒ–ã€‚
  - éæ•°ç»„å¯¹è±¡çš„å±æ€§ä¸èƒ½ä¿è¯ä»¥ç‰¹å®šçš„é¡ºåºå‡ºç°åœ¨åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ä¸­ã€‚
  - å¸ƒå°”å€¼ã€æ•°å­—ã€å­—ç¬¦ä¸²çš„åŒ…è£…å¯¹è±¡åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨è½¬æ¢æˆå¯¹åº”çš„åŸå§‹å€¼ã€‚
  - undefinedã€ä»»æ„çš„å‡½æ•°ä»¥åŠ symbol å€¼ï¼Œåœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¼šè¢«å¿½ç•¥ï¼ˆå‡ºç°åœ¨éæ•°ç»„å¯¹è±¡çš„å±æ€§å€¼ä¸­æ—¶ï¼‰æˆ–è€…è¢«è½¬æ¢æˆ nullï¼ˆå‡ºç°åœ¨æ•°ç»„ä¸­æ—¶ï¼‰ã€‚å‡½æ•°ã€undefined è¢«å•ç‹¬è½¬æ¢æ—¶ï¼Œä¼šè¿”å› undefinedï¼Œå¦‚JSON.stringify(function(){}) or JSON.stringify(undefined).
  - å¯¹åŒ…å«å¾ªç¯å¼•ç”¨çš„å¯¹è±¡ï¼ˆå¯¹è±¡ä¹‹é—´ç›¸äº’å¼•ç”¨ï¼Œå½¢æˆæ— é™å¾ªç¯ï¼‰æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œä¼šæŠ›å‡ºé”™è¯¯ã€‚
  - æ‰€æœ‰ä»¥ symbol ä¸ºå±æ€§é”®çš„å±æ€§éƒ½ä¼šè¢«å®Œå…¨å¿½ç•¥æ‰ï¼Œå³ä¾¿ replacer å‚æ•°ä¸­å¼ºåˆ¶æŒ‡å®šåŒ…å«äº†å®ƒä»¬ã€‚
  - Date æ—¥æœŸè°ƒç”¨äº† toJSON() å°†å…¶è½¬æ¢ä¸ºäº† string å­—ç¬¦ä¸²ï¼ˆåŒDate.toISOString()ï¼‰ï¼Œå› æ­¤ä¼šè¢«å½“åšå­—ç¬¦ä¸²å¤„ç†ã€‚
  - NaN å’Œ Infinity æ ¼å¼çš„æ•°å€¼åŠ null éƒ½ä¼šè¢«å½“åš nullã€‚
  - å…¶ä»–ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬ Map/Set/WeakMap/WeakSetï¼Œä»…ä¼šåºåˆ—åŒ–å¯æšä¸¾çš„å±æ€§ã€‚


# parse

parse() æ–¹æ³•ç”¨äºå°†ä¸€ä¸ª JSON å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯¹è±¡ã€‚

> JSON.parse(text[, reviver])

## textå‚æ•°

textå‚æ•°æ²¡å•¥å¯è¯´çš„ï¼Œå°±æ˜¯è¦è¢«è§£ææˆ JavaScript å€¼çš„å­—ç¬¦ä¸²ï¼Œå¿…é¡»ç¬¦åˆ[JSON](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON)çš„è¯­æ³•æ ¼å¼

```js
JSON.parse('{}') // {}
// å¦‚æœä¼ å…¥çš„å­—ç¬¦ä¸²ä¸æ˜¯æœ‰æ•ˆçš„ JSON æ ¼å¼, JSON.parseæ–¹æ³•å°†æŠ¥é”™ã€‚
JSON.parse("'String'") // Uncaught SyntaxError: Unexpected token ' in JSON at position 0
```

## reviverå‚æ•°

reviverå‚æ•°å’ŒJSON.stringifyæ–¹æ³•çš„reviverå‚æ•°ç±»ä¼¼ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯å¦‚æœæœ‰æ·±å±‚å¯¹è±¡ï¼Œä»–çš„éå†é¡ºåºä¾ç…§ï¼š

ä»æœ€å†…å±‚å¼€å§‹ï¼ŒæŒ‰ç…§å±‚çº§é¡ºåºï¼Œä¾æ¬¡å‘å¤–éå†ï¼Œè€ŒJSON.stringifyçš„éå†é¡ºåºåˆšå¥½ç›¸åï¼Œä»å¤–å‘å†…

```js
JSON.parse('{"1": 1, "2": 2,"3": {"4": 4, "5": {"6": 6}}}', function (k, v) {
    console.log(k); // è¾“å‡ºå½“å‰çš„å±æ€§åï¼Œä»è€Œå¾—çŸ¥éå†é¡ºåºæ˜¯ä»å†…å‘å¤–çš„ï¼Œ
                    // æœ€åä¸€ä¸ªå±æ€§åä¼šæ˜¯ä¸ªç©ºå­—ç¬¦ä¸²ã€‚
    return v;       // è¿”å›åŸå§‹å±æ€§å€¼ï¼Œç›¸å½“äºæ²¡æœ‰ä¼ é€’ reviver å‚æ•°ã€‚
}) // 1 2 4 6 5 3 ""

JSON.stringify({"1": 1, "2": 2,"3": {"4": 4, "5": {"6": 6}}}, function (k, v) {
    console.log(k); 
    return v;      
}) // "" 1 2 3 4 5 6
```

# å‚è€ƒé“¾æ¥

- [JSONå¯¹è±¡](https://javascript.ruanyifeng.com/stdlib/json.html)
- [JSON](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON)

# æœ€å

è™½ç„¶æœ¬æ–‡ç½—å—¦äº†ç‚¹ï¼Œä½†è¿˜æ˜¯æ„Ÿè°¢å„ä½è§‚ä¼—è€çˆ·çš„èƒ½çœ‹åˆ°æœ€å O(âˆ©_âˆ©)O å¸Œæœ›ä½ èƒ½æœ‰æ‰€æ”¶è· ğŸ˜
